if(lang=="en"){var langTextArray=new Array();langTextArray.btn_ok="OK";langTextArray.email="Email";langTextArray.msg_drag="Drag this to your bookmarks bar.";langTextArray.msg_right_click="Right-click on this and add it to your favorites.";langTextArray.msg_username="Please enter your username.";langTextArray.msg_password="Please enter your password.";langTextArray.using="using";langTextArray.email_message="Message:";langTextArray.msg_blogger_dtls="Invalid Blogger Username or Password";langTextArray.msg_signon_blog="You have successfully signed on. Please select a blog.";langTextArray.msg_cred_rem="Remembering Credentials is for Signed in Users Only";langTextArray.msg_not_connect="Unable to connect to your blog.";langTextArray.msg_error_post="Error while trying to post to your blog.";langTextArray.msg_status_update="Please enter a status update.";langTextArray.msg_twitter_long="Twitter post too long. Please shorten to less than 140 characters.";langTextArray.msg_twitter_dtls="Invalid Twitter Username or Password";langTextArray.msg_server_connect="Unable to connect to ShareThis server.";langTextArray.msg_typepad_dtls="Invalid Typepad Username or Password";langTextArray.msg_enter_url="Please enter a url.";langTextArray.msg_check_userpass="Please Check Username and Password.";langTextArray.msg_postfail="Post Failed.";langTextArray.msg_invalid_userpass="Invalid Username or password.";langTextArray.msg_seprated_comma="Separated by commas";langTextArray.msg_shared_using="Shared using ShareThis";langTextArray.msg_enter_email="Please enter your valid E-mail address";langTextArray.msg_enter_recip="Please enter a recipient";langTextArray.msg_phone_no="Not a valid Phone Number";langTextArray.msg_aim_screen="Not a valid AIM Screen Name";langTextArray.msg_email_invalid="Not a valid E-mail address";langTextArray.msg_enter_valid_email="Please enter an E-mail address.";langTextArray.msg_email_address="Please enter a valid E-mail address.";langTextArray.msg_your_name="Please enter your Name.";langTextArray.msg_enter_username="Please enter a username.";langTextArray.msg_enter_apassword="Please enter a password.";langTextArray.msg_password_len="Password must be at least 6 characters.";langTextArray.msg_password_match="Please confirm that your passwords match.";langTextArray.msg_dtls_inuse="E-mail address or Username is already in use.";langTextArray.msg_reg_incomplete="Could not complete registration.";langTextArray.msg_optional="optional";langTextArray.msg_comments="Comments";langTextArray.msg_item_saved="This item was successfully saved to your ShareBox.";langTextArray.msg_not_save_sharebox="Could not save to your ShareBox.";langTextArray.msg_creating_acc="Creating your account";langTextArray.msg_your_email="Your Email Address";langTextArray.msg_enter_recipto="Please enter a recipient in the 'To' field";langTextArray.msg_less_recip="Please enter less than 25 recipients";langTextArray.msg_not_sent="Could not send your message.";langTextArray.msg_importing_cont="Importing contacts";langTextArray.msg_succ_cont="Success! #%num%# contacts imported.";langTextArray.msg_not_retrive="Could not retrieve your contacts.";langTextArray.msg_import_serv="Import contacts from";langTextArray.msg_service="We'll take you to #%name%# where you'll be asked to let ShareThis access your address book.";langTextArray.msg_fail_cont="Contact Import Failed.";langTextArray.msg_timeout="Authorization Timed Out.";langTextArray.acc_linking_info="We have identified an account that already exists with the same email.  Would you like to link the accounts so that they share the same contacts and ShareBox?  If so, then verify the password for the existing account below.";langTextArray.yahoo_linking_info="Would you like to link your Yahoo credentials to an existing ShareThis account so that your shares & contacts will be saved to the same place?  If so, then please provide the appropriate sign in credentials below.";langTextArray.msg_unable_signin="Unable to Sign In";langTextArray.msg_yahoo_signin="Sign In with Yahoo!";langTextArray.msg_yahoo="We'll take you to Yahoo where you'll be asked to link your Yahoo account to ShareThis.";langTextArray.msg_feed="Include shares in my Y! feed";langTextArray.msg_share_yahoo_updt="Post shares to Yahoo! Updates";langTextArray.msg_import_yahoo="Import my Yahoo! contacts";langTextArray.msg_signin_share="Sign In with ShareThis";langTextArray.msg_waiting_auth="Waiting for Authorization";langTextArray.username="Username:";langTextArray.password="Password:";langTextArray.msg_failed_signin="Signin Failed.";langTextArray.msg_shared="Your message was successfully shared!";langTextArray.msg_posting_share="Posting your share to";langTextArray.msg_posting_blog="Post this to your blog";langTextArray.msg_lovejournal="Post this to Livejournal.";langTextArray.msg_post_typepad="Post this to your Typepad blog.";langTextArray.msg_post_wordpress="Post this to your WordPress blog.";langTextArray.msg_comment="Comment:";langTextArray.msg_text="Text";langTextArray.msg_must_register="You must register to save items to a ShareBox.";langTextArray.msg_encoded="Encoded URLs are not allowed";langTextArray.msg_usrl_share="Shar URLs are allowed";langTextArray.msg_goto="Go To Page";langTextArray.msg_incorrect_pass="Email/Username or Password is incorrect. Please try again.";langTextArray.msg_server_connect_auth="Unable to connect to ShareThis authentication server.";langTextArray.msg_logingin="Logging in";langTextArray.post_twitter="Post this to your Twitter status.";langTextArray.msg_nichname_inuse="Nickname already in use.";langTextArray.msg_loading="Loading..."}var Widget=new Class({Implements:Events,shareables:[],shareablesKey:"",shareableIndex:0,authToken:"",user:null,maxContactSearchResults:5,maxSendMessageLength:2000,initialize:function(){this.user=new Widget.User(this);window.contacts=this.contacts;this.pages=this.initializePages(this.pages)},setMaxContactSearchResults:function(a){this.maxContactSearchResults=a},userIsSignedIn:function(){return this.user.isSignedIn()},signOut:function(){forgetUser();this.user.signOut()},limitCharacters:function(d,a,e,f){var b=true;if(d.value.length>=a){switch(f.key){case"up":case"down":case"left":case"right":case"del":case"delete":case"backspace":b=true;break;default:b=false;break}}else{if(d.value.length>=a-10){e.style.color="#FF0000"}else{if(d.value.length>=a-20){e.style.color="#5C0002"}else{e.style.color="#666666"}}}e.set("html",a-d.value.length);return b},postBlogger:function(){var f=$("post_username").value;var l=$("post_password").value;if($("post_remember_me").checked){var k=1}else{var k=0}if($("post_forget_me").value==="true"){var h=1}else{var h=0}var d="";var m=false;if(!f&&!b){m=true;d+=langTextArray.msg_enter_username+"\n"}if(!l&&!b){m=true;d+=langTextArray.msg_enter_apassword+"\n"}if(m){widget.validationFailed(d)}else{if(document.getElementById("post_select")){var b=$("post_select").get("value")}var g="";var a=glo_title;try{a=decodeURIComponent(glo_title)}catch(d){}var j="<a href="+getSharURL()+">"+a+"</a>";if(glo_content!==""){j=""}j=encodeURIComponent(j);if(!b){g="username="+f+"&password="+l+"&d="+glo_content+j+"&draft="+glo_bloggerDraft+"&t="+glo_title+"&return=json&rememberme="+k+"&forgetme="+h}else{g="username="+f+"&password="+l+"&d="+glo_content+j+"&draft="+glo_bloggerDraft+"&t="+glo_title+"&return=json&blogid="+b+"&rememberme="+k+"&forgetme="+h}var e=new Request({method:"post",url:"/api/postBlogger_ws.php",data:g,onFailure:function(){logError("postblogger","Ajax Failure")},onSuccess:this.postBlogger_onSuccess.bind(this)});this.fireEvent("postToServiceRequested","blogger");e.send()}},postBlogger_onSuccess:function(b,e){try{var d=JSON.decode(b)}catch(a){logError("post blogger",b)}if(d.status.toLowerCase()=="success"){this.fireEvent("postToServiceSucceeded","blogger")}if(d.status==="FAILURE"){if(d.errorMessage&&d.errorMessage.toLowerCase()==="auth_failed"){this.fireEvent("postToServiceFailed",["blogger",langTextArray.msg_blogger_dtls])}else{if(d.errorMessage&&d.errorMessage.toLowerCase()==="multiple"){this.fireEvent("postToServiceNeedsMoreInfo",["blogger",langTextArray.msg_signon_blog,d.data])}else{if(d.statusMessage&&d.statusMessage.toLowerCase()==="missing_parameter_token"){this.fireEvent("postToServiceFailed",["blogger",langTextArray.msg_cred_rem,d.data])}else{logError("get contacts",JSON.encode(d));this.fireEvent("postToServiceFailed",["blogger",langTextArray.msg_not_connect])}}}}},postLive_journal:function(){var f=$("post_username").value;var l=$("post_password").value;var g=$("post_message").value;if(g===langTextArray.msg_optional){g=""}g=encodeURIComponent(g);if($("post_remember_me").checked){var k=1}else{var k=0}if($("post_forget_me").value==="true"){var h=1}else{var h=0}var b="";var m=false;if(!f){m=true;b+=langTextArray.msg_enter_username+"\n"}if(!l){m=true;b+=langTextArray.msg_enter_apassword+"\n"}var a=glo_title;try{a=decodeURIComponent(glo_title)}catch(b){}var j="<a href="+getSharURL()+">"+a+"</a>";if(glo_content!==""){j=""}j=encodeURIComponent(j);if(m){widget.validationFailed(b)}else{var e="";e="username="+f+"&password="+l+"&d="+g+"<br/><br/>"+glo_content+j+"&t="+glo_title+"&return=json&rememberme="+k+"&forgetme="+h;var d=new Request({method:"post",url:"/api/postLiveJournal_ws.php",data:e,onFailure:function(){logError("postLiveJournal","Ajax Failure")},onSuccess:this.postLive_journal_onSuccess.bind(this)});this.fireEvent("postToServiceRequested","livejournal");d.send()}},postLive_journal_onSuccess:function(b,e){try{var d=JSON.decode(b)}catch(a){logError("post_live_journal",b)}if(d.status.toLowerCase()==="success"){this.fireEvent("postToServiceSucceeded","livejournal")}else{logError("postLiveJournal",JSON.encode(d));this.fireEvent("postToServiceFailed",["livejournal",langTextArray.msg_error_post])}},postTwitter:function(){var b=$("post_message").value;var a=false;if(!b){a=true;err+=langTextArray.msg_status_update+"\n"}if(b.length>140){a=true;err+=langTextArray.msg_twitter_long+"\n"}if(a){widget.validationFailed(err)}else{var e="";e="status="+encodeURIComponent(b)+"&url="+glo_url+"&sessionID="+glo_sessionID+"&return=json";var d=new Request({method:"post",url:"/api/postTwitter_ws.php",data:e,onFailure:function(){logError("postTwitter","Ajax Failure")},onSuccess:this.postTwitter_onSuccess.bind(this)});this.fireEvent("postToServiceRequested","twitter");d.send()}},postTwitter_onSuccess:function(b,e){try{var d=JSON.decode(b)}catch(a){logError("postTwitter",b)}if(d.status&&d.status.toLowerCase()=="success"){this.fireEvent("postToServiceSucceeded","twitter.com")}else{if(d.errorMessage){if(d.errorMessage.toLowerCase()=="auth_failed"){this.fireEvent("postToServiceFailed",["twitter",langTextArray.msg_twitter_dtls])}else{if(d.statusMessage&&(d.statusMessage.toLowerCase()==="missing_parameter_token")){this.fireEvent("postToServiceFailed",["twitter",langTextArray.msg_cred_rem])}else{this.fireEvent("postToServiceFailed",["twitter",d.errorMessage])}}}else{logError("postTwitter",JSON.encode(d));this.fireEvent("postToServiceFailed",["twitter",langTextArray.msg_server_connect])}}},postTypePad:function(){var f=$("post_username").value;var l=$("post_password").value;if($("post_remember_me").checked){var k=1}else{var k=0}if($("post_forget_me").value=="true"){var h=1}else{var h=0}var d="";var m=false;if(!f&&!b){m=true;d+=langTextArray.msg_enter_username+"\n"}if(!l&&!b){m=true;d+=langTextArray.msg_enter_apassword+"\n"}if(m){widget.validationFailed(d)}else{if(document.getElementById("post_select")){var b=$("post_select").get("value")}var g="";var a=glo_title;try{a=decodeURIComponent(glo_title)}catch(d){}var j="<a href="+getSharURL()+">"+a+"</a>";if(glo_content!==""){j=""}j=encodeURIComponent(j);if(!b){g="username="+f+"&password="+l+"&d="+glo_content+j+"&draft="+glo_tpDraft+"&t="+glo_title+"&return=json&rememberme="+k+"&forgetme="+h}else{g="blogid="+b+"&d="+glo_content+j+"&draft="+glo_tpDraft+"&password="+l+"&t="+glo_title+"&username="+f+"&return=json&rememberme="+k+"&forgetme="+h}var e=new Request({method:"post",url:"/api/postTypePad_ws.php",data:g,onFailure:function(){logError("postTypePad","Ajax Failure")},onSuccess:this.postTypePad_onSuccess.bind(this)});this.fireEvent("postToServiceRequested","typepad");e.send()}},postTypePad_onSuccess:function(b,e){try{var d=JSON.decode(b)}catch(a){logError("post typepad",b)}if(d.status.toLowerCase()=="success"){this.fireEvent("postToServiceSucceeded","typepad")}if(d.status.toLowerCase()=="failure"){if(d.errorMessage&&d.errorMessage.toLowerCase()=="auth_failed"){this.fireEvent("postToServiceFailed",["typepad",langTextArray.msg_typepad_dtls])}if(d.errorMessage&&d.errorMessage.toLowerCase()=="multiple"){this.fireEvent("postToServiceNeedsMoreInfo",["typepad",langTextArray.msg_signon_blog,d.data])}else{logError("postTypePad",JSON.encode(d));this.fireEvent("postToServiceFailed",["typepad",langTextArray.msg_not_connect])}}},postWordpress:function(){var g=$("post_username").value;var l=$("post_password").value;var a=$("post_url").value;if($("post_remember_me").checked){var k=1}else{var k=0}if($("post_forget_me").value=="true"){var h=1}else{var h=0}var d="";var m=false;if(!g){m=true;d+=langTextArray.msg_enter_username+"\n"}if(!l){m=true;d+=langTextArray.msg_enter_apassword+"\n"}if(!a){m=true;d+=langTextArray.msg_enter_url+"\n"}var b=glo_title;try{b=decodeURIComponent(glo_title)}catch(d){}var j="<a href="+getSharURL()+">"+b+"</a>";if(glo_content!==""){j=""}j=encodeURIComponent(j);if(m){this.validationFailed(d)}else{var f="";f="username="+g+"&password="+l+"&d="+glo_content+j+"&t="+glo_title+"&return=json&url="+a+"&rememberme="+k+"&forgetme="+h;var e=new Request({method:"post",url:"/api/postWordPress_ws.php",data:f,onFailure:function(){logError("postWordpress","Ajax Failure")},onSuccess:this.postWordpress_onSuccess.bind(this)});this.fireEvent("postToServiceRequested","wordpress");e.send()}},postWordpress_onSuccess:function(b,e){try{var d=JSON.decode(b)}catch(a){logError("post wordpress",b)}if(d.status.toLowerCase()==="success"){this.fireEvent("postToServiceSucceeded","wordpress")}else{if(d.errorMessage&&d.errorMessage.toLowerCase()==="connection_failed"){this.fireEvent("postToServiceFailed",["wordpress",langTextArray.msg_not_connect])}else{if(d.errorMessage&&d.errorMessage.toLowerCase()=="auth_failed"){this.fireEvent("postToServiceFailed",["wordpress",langTextArray.msg_check_userpass])}else{if(d.statusMessage&&(d.statusMessage.toLowerCase()=="post_failed"||d.statusMessage.toLowerCase()=="post_wordpress_service_failed")){this.fireEvent("postToServiceFailed",["wordpress",langTextArray.msg_postfail])}else{logError("postWordpress",JSON.encode(d));this.fireEvent("postToServiceFailed",["wordpress",langTextArray.msg_not_connect])}}}}},getQueryParam:function(d,b){d=d.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+d+"=([^&#]*)";var f=new RegExp(a);var e=f.exec(b);if(e==null){return""}else{return e[1]}},updatePreview:function(a){if(this.shareables[a].icon!==""){$("icon").set("html",'<img src="'+this.shareables[a].icon+'" width="100" />')}if(this.shareables[a].url!==""){$("title").set("html",'<a href="'+this.shareables[a].url+'" target="_blank">'+this.shareables[a].title+"</a>")}else{$("title").set("html",this.shareables[a].title)}$("summary").set("html",this.shareables[a].summary);$("content").set("html",this.shareables[a].content)},saveToShareBox:function(b,h){if(b==langTextArray.msg_seprated_comma){b=""}var a=[{type:"sharethis.com",address:(glo_destinationAddress?glo_destinationAddress:"")}];if(typeof b=="string"){b=b.replace(/\s*,\s*/g,",").split(",").join(",")}else{if(typeof b=="object"&&"length" in b){b=b.join(",")}}var e=glo_title;try{e=decodeURIComponent(glo_title)}catch(g){}if(!h||!h.length||h.length==0){h=[{type:"default",url:getSharURL(),title:e,thumbnail:glo_thumb,embed:encodeURIComponent(Url.decode(glo_content)),description:(glo_description?glo_description:""),tags:(b?b:"")}]}var d=(glo_userEmail&&glo_userEmail.length?encodeURIComponent(glo_userEmail):"");var f=new Request({method:"post",url:"/api/createDestination_ws.php",data:{publisher:glo_publisher,objects:encodeURIComponent(JSON.encode(h)),destinations:encodeURIComponent(JSON.encode(a)),sessionID:glo_sessionID,destinationType:"Social","return":"JSON",sender:d},onFailure:function(){logError("save to sharebox","Ajax Failure")},onSuccess:(function(l,m){try{var j=JSON.decode(l)}catch(k){logError("save to sharebox",l)}if(j.status){switch(j.status){case"SUCCESS":widget.fireEvent("saveToShareBoxSucceeded");break;case"FAILURE":widget.fireEvent("saveToShareBoxFailed");logError("save to sharebox",j);break;default:break}}else{logError("save to sharebox",JSON.encode(j));widget.fireEvent("saveToShareBoxFailed")}}).bind(this)});f.send()},extractDomainFromURL:function(b,a){var d=b.replace(/(\w+):\/\/([^\/:]+)(:\d*)?([^# ]*)/,"$2");if(!a&&d.toLowerCase().indexOf("www.")==0){d=d.substring(4)}return d},setCookie:function(d,f){var e=new Date;var h=e.getFullYear();var j=e.getMonth()+2;var g=e.getDate();var b=d+"="+escape(f);if(h){var a=new Date(h,j,g);b+="; expires="+a.toGMTString()}b+="; domain="+escape(".sharethis.com")+";path=/";document.cookie=b},getCookie:function(b){var a=document.cookie.match("(^|;) ?"+b+"=([^;]*)(;|$)");if(a){return(unescape(a[2]))}else{return false}},deleteCookie:function(a){var d="/";var b=".sharethis.com";document.cookie=a+"="+((d)?";path="+d:"")+((b)?";domain="+b:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT"},validationFailed:function(a){widget.pushModalErrorSheet(a.replace(/\n/g,"<br/>"))},truncateText:function(f,e,a){var a=a||8;var d=a*2.5;var b=((f.length*a)-(e-d));if(b>0){return f.substring(0,f.length-Math.ceil(b/a))+"&hellip;"}return f},_deferTimers:{},deferWhile:function(a,d,b){if(this._deferTimers[a]>=0){clearTimeout(this._deferTimers[a])}this._deferTimers[a]=setTimeout((function(){this._deferTimers[a]=-1;d()}).bind(this),(b||10))},_frozenFocusHandler:function(a){if(a.target.hasClass("frozen")){a.target.blur()}},freezeTextInput:function(a){a.disabled=true;a.addClass("frozen");a.addEvent("focus",this._frozenFocusHandler);a.blur()},unfreezeTextInput:function(a){a.disabled=false;a.removeClass("frozen");a.removeEvent("focus",this._frozenFocusHandler)},_profilers:[],pushProfiler:function(a){this._profilers.push({start:$time(),message:a})},popProfiler:function(){if(Browser.Engine.trident){var d=this._profilers.pop();var b="";for(var a=0;a<this._profilers.length;a++){b+="   "}alert(b+d.message+" ["+($time()-d.start)+"]")}else{var d=this._profilers.pop();var b="";for(var a=0;a<this._profilers.length;a++){b+="   "}}}});if(!window.console||!console.firebug){var names=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];window.console={};for(var i=0;i<names.length;++i){window.console[names[i]]=function(){}}}var glo_tabs="web,post,email";var glo_send_services="email,myspace,aim,sms";var glo_tabArray=[];glo_tabArray=glo_tabs.split(",");var glo_charset="utf-8";var glo_services="";var glo_exclusive_services=false;var glo_default_services="myspace,digg,sms,windows_live,delicious,stumbleupon,reddit,google_bmarks,linkedin,bebo,ybuzz,blogger,yahoo_bmarks,mixx,technorati,friendfeed,propeller,wordpress,newsvine,xanga,blinklist,twine,twackle,diigo,fark,faves,mister_wong,current,livejournal,kirtsy,slashdot,oknotizie,care2,aim,meneame,simpy,blogmarks,n4g,bus_exchange,funp,sphinn,fresqui,dealsplus,typepad,yigg";var glo_top_services="email,facebook,twitter,sharebox";var glo_send_servicesArray=[];var glo_default_swArray=[];glo_default_swArray=glo_default_services.split(",");var glo_style="default";var glo_publisher="";var glo_headerbg="#999999";var glo_headerTitle="";var glo_headerfg="#ffffff";var glo_inactivebg="#D2D2D2";var glo_inactivefg="#424242";var glo_linkfg="#222";var glo_embeds=false;var glo_popup=false;var glo_offsetLeft=0;var glo_offsetTop=0;var glo_isLoggedIn=false;var glo_authToken="";var glo_userName="";var glo_userEmail="";var glo_facebook="";var glo_aim="";var glo_greyBoxNum=0;var glo_contProto=[];var glo_contName=[];var glo_contAdd=[];var glo_contRes=[];var glo_contResNum=0;var glo_swArray=[];var glo_swArray_more=[];var glo_msgArray=[];var glo_hostname="";var glo_location="";var glo_url="";var glo_title="";var glo_type="default";var glo_content="";var glo_summary="";var glo_icon="";var glo_category="";var glo_updated="";var glo_published="";var glo_author="";var glo_totalRegSW=0;var glo_tpDraft=1;var glo_bloggerDraft=1;var glo_guid="";var glo_guid_index=null;var glo_title_array=[];var glo_summary_array=[];var glo_content_array=[];var glo_url_array=[];var glo_icon_array=[];var glo_category_array=[];var glo_updated_array=[];var glo_published_array=[];var glo_author_array=[];var glo_type_array=[];var glo_tags_array=[];var glo_thumb_array=[];var glo_description_array=[];var glo_last_search="";var glo_thumb="";var glo_tags="";var glo_description="";var glo_num_diggs=0;var glo_digg_comments=0;var glo_pageOptions=false;var glo_swDiv="";var glo_oldQS="";var glo_destinations="";var glo_page_url="";var glo_page_title="";var glo_jsonStr="";var glo_jsonArray=[];var glo_destinationAddress="";var glo_destinationType="Social";var glo_options_popup=false;var displayNum=20;var glo_last_url="";var glo_last_url2="";var glo_initRun=false;var domReady=false;var bufferArgs=[];var bufferValue=[];var bufferRunArgs=[];var glo_hash_flag=false;var glo_sessionID=null;var glo_fpc=null;var glo_thumbImageTag="";var glo_browser="";var glo_toolbar=false;var glo_tracking="";var glo_googleProfileId="";var googlePubTracker="";var glo_omnitureURL="";var glo_sharURL="";var import_cookie="";var signin_cookie="";var glo_thirdparty_flag="";var glo_thirdparty_origin="";var glo_thirdparty_signin="";var glo_thirdparty_import_contacts="";var glo_thirdparty_email="";var glo_thirdparty_oauth_token="";var glo_thirdparty_existing_email="";var glo_thirdparty_service_feed="";var import_cookie_tid;var signin_cookie_tid;var import_cookie_cycles=0;var signin_cookie_cycles=0;var glo_ads=false;var glo_adtag_header="";var glo_adtag_footer="";var glo_page="";var glo_post_page=[];var glo_credentials=[];var glo_pUrl="";var glo_widget_info=[];var segmentRun=false;var glo_login_poller=null;var glo_import_poller=null;segmentframe=null;var glo_userType=null;try{segmentframe=document.createElement('<iframe name="stframe" allowTransparency="true" style="body{background:transparent;}" ></iframe>')}catch(err){segmentframe=document.createElement("iframe")}segmentframe.id="stSegmentFrame";segmentframe.name="stSegmentFrame";function css_browser_selector(e){var f=e.toLowerCase(),m=function(b){return f.indexOf(b)>-1},l="gecko",d="webkit",k="safari",j=document.getElementsByTagName("html")[0],a=[(!(/opera|webtv/i.test(f))&&/msie\s(\d)/.test(f))?("ie ie"+RegExp.$1):m("firefox/2")?l+" ff2":m("firefox/3")?l+" ff3":m("gecko/")?l:/opera(\s|\/)(\d+)/.test(f)?"opera opera"+RegExp.$2:m("konqueror")?"konqueror":m("chrome")?d+" "+k+" chrome":m("applewebkit/")?d+" "+k+(/version\/(\d+)/.test(f)?" "+k+RegExp.$1:""):m("mozilla/")?l:"",m("j2me")?"mobile":m("iphone")?"iphone":m("ipod")?"ipod":m("mac")?"mac":m("darwin")?"mac":m("webtv")?"webtv":m("win")?"win":m("freebsd")?"freebsd":(m("x11")||m("linux"))?"linux":"","js"];c=a.join(" ");j.className+=" "+c;return c}var glo_browser=css_browser_selector(navigator.userAgent);var tstArray=[];function fragObj(a,b){this.frag=a;this.qs=b}function readyTest(){for(var b=0;b<tstArray.length;b++){var a=tstArray[b].frag+" = \n"+tstArray[b].qs;alert(a)}}function setGlobals(f,j){var h="";if(j===0){h="No"}if(j===1){h="Yes"}try{j=decodeURIComponent(j)}catch(e){}try{j=decodeURIComponent(j)}catch(e){}switch(f){case"tabs":glo_tabs=j;glo_tabArray=j.split(",");tab_servicesChanged();break;case"charset":glo_charset=j;break;case"services":glo_servces=j;glo_swArray=j.split(",");break;case"exclusive_services":glo_exclusive_services=j;break;case"style":glo_style=j;break;case"publisher":glo_publisher=j;break;case"headerbg":glo_headerbg=j;$$(".header-color").setStyle("background-color",j);break;case"inactivebg":glo_inactivebg=j;$$(".nav-inactive-color").setStyle("background-color",j);break;case"inactivefg":glo_inactivefg=j;$$(".nav-inactive-color").setStyle("color",j);break;case"linkfg":glo_linkfg=j;setTimeout("widget.fireEvent('linkForegroundColorChanged', glo_linkfg)",10);break;case"embeds":glo_embeds=j;break;case"popup":glo_popup=j;break;case"offsetLeft":glo_offsetLeft=j;break;case"offsetTop":glo_offsetTop=j;break;case"auth":glo_authToken=j;break;case"userEmail":glo_userEmail=j;if(j.length>3){$("from_box").addClass("hidden")}break;case"userName":glo_userName=j;break;case"facebook":glo_facebook=j;break;case"aim":glo_aim=j;break;case"contProto":glo_contProto.push(j);break;case"contName":glo_contName.push(j);break;case"contAdd":glo_contAdd.push(j);break;case"contName":glo_contRes.push(j);break;case"contResNum":glo_contResNum=j;break;case"loggedIn":glo_isLoggedIn=j;if(glo_isLoggedIn===true){$("boxToYourAddr").addClass("hidden");$$(".guest").addClass("hidden")}else{$("boxToYourAddr").removeClass("hidden");$$(".guest").removeClass("hidden")}break;case"hostname":glo_hostname=encodeURIComponent(j);break;case"location":glo_location=encodeURIComponent(j);break;case"url":if(j!==glo_url&&j!==undefined){if(typeof(j)!=="string"){try{glo_url=j.href}catch(e){}}else{glo_url=j}glo_thumbImageTag="http://sharethis.com/share/thumb?url="+glo_url;$("previewUrl").set("text",widget.extractDomainFromURL(glo_url));getDiggs(glo_url);var d="http://sharethis.com/stream?src="+widget.extractDomainFromURL(glo_url);var b=new Element("a",{rel:"external",style:"color:#fff;",target:"_blank",href:d});b.addEvent("click",(function(a){gaLog("Footer","livestream_link","See what your friends are sharing");if(glo_options_popup==true){popupOpen2(this);return false}}).bind(b));$("livestream_link").set("html","");$("livestream_link").appendChild(b);b.appendText("See what your friends are sharing");$("livestream_link").setStyle("display","block")}break;case"title":glo_title=j;if(glo_title==""||glo_title=="undefined"){glo_title=decodeURIComponent(glo_url)}try{j=decodeURIComponent(j)}catch(e){}if(j.length>80){j=j.slice(0,77);j+="..."}$("previewTitle").set("text",j);widget.fireEvent("shareableTitleChanged",glo_title);break;case"type":glo_type=j;break;case"icon":glo_icon=j;if(j.length>5){glo_thumbImageTag=j}break;case"category":glo_category=j;break;case"updated":glo_updated=j;break;case"published":glo_published=j;break;case"author":glo_author=j;break;case"summary":glo_summary=j;break;case"content":glo_content=encodeURIComponent(j);break;case"glo_tpDraft":glo_tpDraft=j;break;case"glo_bloggerDraft":glo_bloggerDraft=j;break;case"guid":if(glo_guid===""&&j!==null&&j!=="null"){glo_guid=j;getObjects()}break;case"guid_index":glo_guid_index=j;setValues();break;case"glo_title_array":glo_title_array.push(j);break;case"glo_type_array":glo_type_array.push(j);break;case"glo_summary_array":glo_summary_array.push(j);break;case"glo_content_array":glo_content_array.push(j);break;case"glo_url_array":glo_url_array.push(j);break;case"glo_icon_array":glo_icon_array.push(j);break;case"glo_category_array":glo_category_array.push(j);break;case"glo_updated_array":glo_updated_array.push(j);break;case"glo_published_array":glo_published_array.push(j);break;case"glo_author_array":glo_author_array.push(j);break;case"glo_thumb":glo_thumb=j;break;case"glo_tags":glo_tags=j;break;case"glo_description":glo_description=j;glo_description=encodeURIComponent(glo_description);widget.fireEvent("shareableDescriptionChanged",glo_description&&glo_description!="undefined"?glo_description:"");break;case"glo_thumb_array":glo_thumb_array.push(j);break;case"glo_tags_array":glo_tags_array.push(j);break;case"glo_description_array":glo_description_array.push(j);break;case"pageTitle":glo_page_title=j;break;case"pageURL":glo_page_url=j;break;case"hash_flag":if(j=="true"){glo_hash_flag=true}else{glo_hash_flag=false}break;case"sessionID":glo_sessionID=j;break;case"fpc":glo_fpc=j;break;case"headerTitle":glo_headerTitle=j;widget.fireEvent("headerTitleChanged",j);break;case"headerfg":glo_headerfg=j;widget.fireEvent("headerFGColorChanged",j);break;case"post_services":setGlobals("services",j);break;case"send_services":glo_send_servicesArray=j;send_servicesChanged(j);break;case"glo_toolbar":glo_toolbar=j;$("close_button").set("style","display:inline");break;case"tracking":glo_tracking=j;break;case"googleProfileId":glo_googleProfileId=j;break;case"omnitureURL":glo_omnitureURL=j;break;case"ads":if(j=="true"){glo_ads=true}else{glo_ads=false}break;case"adtag_header":glo_adtag_header=j;if(j!=""){$("header_ad").setStyle("height","40px");$("header_ad").removeClass("hidden")}break;case"adtag_footer":glo_adtag_footer=j;if(j!=""){$("footer_ad").removeClass("hidden")}break;case"page":glo_page=j;if(glo_page=="send"||glo_page.match("post|")){if(glo_page=="post|twitter"&&glo_userType=="twitter"){createSharURL(glo_url,true);widget.fireEvent("twitterClicked",getSharURL());widget.showPage(glo_page)}else{if(glo_page=="post|twitter"&&glo_userType!="twitter"){var g=widget.getServiceLink("twitter");window.open(g,"stpopup","width=970,height=700,location=1,toolbar=1,scrollbars=1,menubar=1,resizable=1")}else{widget.showPage(glo_page)}}}else{widget.showPage("home")}break;case"pUrl":glo_pUrl=j;break;case"userType":glo_userType=j;break;default:break}}function addToOptions(b){var d=[];d=b.split("=");d[0]=decodeURIComponent(d[0]);d[1]=decodeURIComponent(d[1]);try{d[0]=decodeURIComponent(d[0]);d[1]=decodeURIComponent(d[1])}catch(e){}tstArray.push(new fragObj(d[0],d[1]));setGlobals(d[0],d[1])}function addToOptionsBuffer(b){var d=[];d=b.split("=");d[0]=decodeURIComponent(d[0]);d[1]=decodeURIComponent(d[1]);try{d[0]=decodeURIComponent(d[0]);d[1]=decodeURIComponent(d[1])}catch(e){}tstArray.push(new fragObj(d[0],d[1]));bufferArgs.push(d[0]);bufferValue.push(d[1])}function checkBufferArg(b){var d=false;for(var a=0;a<bufferRunArgs.length;a++){if(bufferRunArgs[a]==b){d=true}}return d}function processBuffer(){bufferArgs.reverse();bufferValue.reverse();for(var a=0;a<bufferArgs.length;a++){if(checkBufferArg(bufferArgs[a])===false){bufferRunArgs.push(bufferArgs[a]);setGlobals(bufferArgs[a],bufferValue[a])}}createSwList();switch(glo_tracking){case"google":case"omniture":var b=new Request({method:"post",url:"/api/getPublisherDomains_ws.php",data:"publisher="+glo_publisher+"&return=json",onFailure:function(){logError("glo_tracking","Ajax Failure")},onSuccess:function(h,k){try{var e=JSON.decode(h)}catch(d){logError("glo_tracking",h)}if(e.status==="SUCCESS"){var j=document.referrer;var l=new RegExp("^(http|https)://([^/]*)");var n=j.match(l);var f=n[2];for(var g=0;g<e.data.domain.length;g++){if(f==e.data.domain[g].name){if(e.data.domain[g].google_analytics!=""&&glo_tracking=="google"){setGlobals("googleProfileId",e.data.domain[g].google_analytics);var m=new Element("script").set("src","http://www.google-analytics.com/ga.js").set("type","text/javascript").addEvent("load",function(){googlePubTracker=_gat._getTracker(glo_googleProfileId)}).inject($("container"),"after")}if(e.data.domain[g].omniture!=""&&glo_tracking=="omniture"){setGlobals("omnitureURL",e.data.domain[g].omniture)}}}}else{logError("glo_tracking",JSON.encode(e))}}});b.send();break}if(glo_ads==true){var b=new Request({method:"post",url:"/api/getPublisherDomains_ws.php",data:"publisher="+glo_publisher+"&return=json",onFailure:function(){logError("add Request","Ajax Failure")},onSuccess:function(h,k){try{var e=JSON.decode(h)}catch(d){logError("add request",h)}if(e.status==="SUCCESS"){var j=document.referrer;var l=new RegExp("^(http|https)://([^/]*)");var m=j.match(l);var f=m[2];for(var g=0;g<e.data.domain.length;g++){if(f==e.data.domain[g].name){setGlobals("adtag_header",e.data.domain[g].adtag_widgetheader);setGlobals("adtag_footer",e.data.domain[g].adtag_widgetfooter)}}}else{logError("add Request","Ajax Failure")}}});b.send()}}function send_servicesChanged(e){var a=[];a=e.split(",");var b=false;var g=false;var f=false;for(var d=0;d<a.length;d++){if(a[d]=="email"){b=true}else{if(a[d]=="aim"){g=true}else{if(a[d]=="sms"){f=true}}}}if(b==false||g==false||f==false){var h=[];$each(glo_default_swArray,function(j,k){if(j=="aim"&&g==false){}else{if(j=="sms"&&f==false){}else{h.push(j)}}});glo_default_swArray=h;if(b==false){glo_top_services="facebook,twitter,sharebox"}createSwList()}return"services_changed"}function tab_servicesChanged(){var a=false;var d=false;var e=false;for(var b=0;b<glo_tabArray.length;b++){if(glo_tabArray[b]=="email"){a=true}}if(a==false){var f=[];$each(glo_default_swArray,function(g,h){if(g=="aim"&&e==false){}else{if(g=="sms"&&d==false){}else{f.push(g)}}});glo_default_swArray=f;glo_top_services="facebook,twitter,sharebox";createSwList()}return"services_changed"}function FragmentPump(){var fragTimer="";this.initialize=function(){FragmentPump.fragTimer=setInterval("fragmentPump.checkFragment()",5)};this.startint=function(){setInterval(this.checkFragment.bind(this),250)};this.checkFragment=function(){var hash=document.location.hash.substring(1);if(hash.length>0&&hash!==glo_oldQS){var args=hash.split("/");glo_oldQS=hash;var cmd=args.shift();cmd="fragmentPump."+cmd;var temp="";for(var i=0;i<args.length;i++){temp=temp+'"'+args[i]+'"';if(i<(args.length-1)){temp=temp+","}}var evStr=cmd+"("+temp+")";if(cmd=="fragmentPump.init"||cmd=="fragmentPump.test"||cmd=="fragmentPump.data"||cmd=="fragmentPump.show"||cmd=="fragmentPump.popup"||cmd=="fragmentPump.widget"){var tempFun=eval("window."+cmd);if(tempFun){var tempFucn=new Function(evStr);tempFucn()}else{}}}};this.init=function(){if(glo_initRun===false){glo_initRun=true;for(var i=0;i<arguments.length;i++){var num=i+1;if(arguments[i]!=""&&arguments[i]!=" "){addToOptionsBuffer(arguments[i])}}glo_pageOptions=true;if(domReady===true){processBuffer()}glo_initRun=true}};this.test=function(){readyTest()};this.data=function(){for(var i=0;i<arguments.length;i++){addToOptions2(arguments[i])}};this.show=function(){gaLog("Widget","widget_open");if(glo_initRun==false){return false}for(var i=0;i<arguments.length;i++){addToOptions(arguments[i])}};this.popup=function(){clearInterval(fragmentPump.fragTimer);clearInterval(FragmentPump.fragTimer);glo_options_popup=true;displayNum=24;for(var i=0;i<arguments.length;i++){var num=i+1;addToOptionsBuffer(arguments[i])}if(domReady===true){processBuffer()}glo_initRun=true};this.widget=function(){if(arguments.length){var kvPairs=arguments[0].split("=");for(var i=0;i<kvPairs.length;i+=2){switch(kvPairs[i]){case"screen":widget.showPage(kvPairs[i+1]);$("header_ad").empty();$("footer_ad_body").empty();break}}}};this.initialize()}var fragmentPump=new FragmentPump();function addToOptions2(b){var d=[];d=b.split("=");d[0]=decodeURIComponent(d[0]);try{d[0]=decodeURIComponent(d[0]);d[1]=decodeURIComponent(d[1])}catch(e){}if(d[0]=="pageHost"){setGlobals("hostname",d[1])}else{if(d[0]=="pagePath"){setGlobals("location",d[1])}}tstArray.push(new fragObj(d[0],d[1]));if(d[1]=="done"){if(glo_initRun===false){document.location.hash=glo_initFrag}glo_jsonStr=glo_jsonArray.join("");glo_jsonArray=[];glo_title_array=[];glo_type_array=[];glo_summary_array=[];glo_content_array=[];glo_url_array=[];glo_icon_array=[];glo_category_array=[];glo_updated_array=[];glo_published_array=[];glo_author_array=[];glo_thumb_array=[];processFrag()}else{if(d[0]=="jsonData"){glo_jsonArray.push(d[1])}}}function forgetUser(){setGlobals("loggedIn",false);$("boxToYourAddr").removeClass("hidden");$("textAuthInfoEmail").addClass("hidden");$("textAuthInfoEmail").set("html","");setGlobals("auth","");setGlobals("userName","");setGlobals("userEmail","");setGlobals("userType","");setGlobals("facebook","");setGlobals("aim","");setGlobals("contProto",[]);setGlobals("contName",[]);setGlobals("contAdd",[]);setGlobals("contResNum",0);emptyInputs();widget.deleteCookie("ShareUT");glo_contProto=[];glo_contName=[];glo_contAdd=[];glo_contRes=[];glo_contResNum=0}function emptyInputs(){$$("input[type=text]").set("value","");$$("input[type=password]").set("value","");$$("input[type=password]").set("value","");$$("textarea").set("value","");$("post_select_container").set("html","")}function gaLog(b,e,a,d){if(typeof(pageTracker)!="undefined"){pageTracker._trackEvent(b,e,a,d)}}function cleanURL(e){var d=window.location.hash;var b=new RegExp("STS=","i");var a=d.match(b);if(a!=null){var f=e.split("#");return f[0]}else{return e}}function logSW(a){if(glo_tracking=="google"&&glo_googleProfileId!=""){url="/ShareThis/social/"+a+"/"+glo_title;if(googlePubTracker!=""){googlePubTracker._trackPageview(url)}}if(glo_tracking=="omniture"&&glo_omnitureURL!=""){url=glo_omnitureURL+"?sms_st=social&sms_ss="+a+"&sms_sa="+encodeURIComponent(glo_title);tracker=new Element("iframe").set("src",url).set("style","position:absolute;top:0;left:0;width:0;height:0;visibility:hidden").inject($("container"),"after")}}function logEvent(a,e){var g="";if(glo_toolbar!=false){g="toolbar"}else{if(glo_page!="home"&&glo_page!=""){g="chicklet"}else{g="button"}}var f="http://l.sharethis.com/log?event="+e;f+="&source="+g;f+="&publisher="+encodeURIComponent(glo_publisher);f+="&hostname="+encodeURIComponent(glo_hostname);f+="&location="+encodeURIComponent(glo_location);f+="&destinations="+a;f+="&ts"+(new Date()).getTime();f+="&title="+encodeURIComponent(glo_title);f+="&url="+encodeURIComponent(cleanURL(glo_url));f+="&sessionID="+glo_sessionID;f+="&fpc="+glo_fpc;var d=new Image(1,1);d.src=f;d.onload=function(){return};if(glo_tracking=="google"&&glo_googleProfileId!=""){destinations=a.split(",");for(var b=0;b<destinations.length;b++){url="/ShareThis/"+e+"/"+destinations[b]+"/"+glo_title;if(googlePubTracker!=""){googlePubTracker._trackPageview(url)}}}if(glo_tracking=="omniture"&&glo_omnitureURL!=""){destinations=a.split(",");for(var b=0;b<destinations.length;b++){url=glo_omnitureURL+"?sms_st="+e+"&sms_ss="+destinations[b]+"&sms_sa="+encodeURIComponent(glo_title);tracker=new Element("iframe").set("src",url).set("style","position:absolute;top:0;left:0;width:0;height:0;visibility:hidden").inject($("container"),"after")}}if(e=="post"){glo_destinationType="Post";sendDestination(a)}}function genTopServices(){var a=new Element("div",{id:"top_services"});var b=glo_top_services.split(",");$each(b,function(e){var d=widget.getServiceLink(e);d.addClass("top_service");d.inject(a)});a.replaces($("top_services"))}function createSwList(){genTopServices();var e=[];var a=glo_default_services;var d=glo_default_swArray;var f=widget.user.getShareServiceHistory().map(function(h){return h.service});var g=glo_swArray;if(!f.length&&!g.length){setGlobals("services",a)}var b=true;if(glo_exclusive_services){$each(d,function(h,j){var l=widget.getServiceLink(d[j]);var m=g.indexOf(d[j]);if(m>-1){var k=f.indexOf(d[j]);e.push({getContent:function(){return l},hasPublisherPref:(m>-1),hasUserPref:(b?(k>-1):false),stIndex:j,publisherIndex:m,userIndex:k,tag:d[j]})}});widget.carousel.createPaginator()}else{$each(d,function(h,j){var l=widget.getServiceLink(d[j]);var m=g.indexOf(d[j]);var k=f.indexOf(d[j]);e.push({getContent:function(){return l},hasPublisherPref:(m>-1),hasUserPref:(b?(k>-1):false),stIndex:j,publisherIndex:m,userIndex:k,tag:d[j]})})}widget.carousel.setDataSource(e);if(glo_pageOptions==true){setTimeout("widget.fireEvent('linkForegroundColorChanged', glo_linkfg)",10)}}function popupOpen(a){var f="";var e=a.getElementsByTagName("a");for(var d=0;d<e.length;d++){var b=e[d];f=b.href}window.open(f,"stpopup","width=970,height=700,location=1,toolbar=1,scrollbars=1,menubar=1,resizable=1");return false}function popupOpen2(a){var d=a.href;try{window.open(d,"stpopup","width=970,height=700,location=1,toolbar=1,scrollbars=1,menubar=1,resizable=1")}catch(b){}return false}function getObjects(){var a=new Request({method:"post",url:"/api/getCache_ws.php",data:"key="+glo_guid+"&return=json",onFailure:function(){logError("getObjects","Ajax Failure")},onSuccess:getObjects_onSuccess});a.send()}function getObjects_onSuccess(f,h){try{var a=JSON.decode(f)}catch(b){logError("getObjects",f)}if(a.status=="SUCCESS"){var g=Url.decode(a.data);var e=JSON.decode(g);for(i=0;i<e.length;i++){setGlobals("glo_title_array",e[i].title);setGlobals("glo_type_array",e[i].type);setGlobals("glo_summary_array",e[i].summary);setGlobals("glo_content_array",e[i].content);setGlobals("glo_url_array",e[i].url);setGlobals("glo_icon_array",e[i].icon);setGlobals("glo_category_array",e[i].category);setGlobals("glo_updated_array",e[i].updated);setGlobals("glo_published_array",e[i].published);setGlobals("glo_author_array",e[i].author);setGlobals("glo_thumb_array",e[i].icon);if(e[i].tags){setGlobals("glo_tags_array",e[i].tags)}if(e[i].description){setGlobals("glo_description_array",e[i].description)}}setValues();if(glo_page=="post|twitter"){var d=widget.getServiceLink("twitter");window.open(d,"stpopup","width=970,height=700,location=1,toolbar=1,scrollbars=1,menubar=1,resizable=1")}}else{logError("getObjects","Ajax Failure")}}function processFrag(){if(glo_browser.test("ff")==false){try{glo_jsonStr=decodeURIComponent(glo_jsonStr)}catch(err){}}var tmp=glo_jsonStr;var newResp=[];try{newResp=eval(tmp)}catch(err){tmp=decodeURIComponent(tmp);newResp=eval(tmp)}for(var i=0;i<newResp.length;i++){setGlobals("glo_title_array",newResp[i].title);setGlobals("glo_type_array",newResp[i].type);setGlobals("glo_summary_array",newResp[i].summary);setGlobals("glo_content_array",newResp[i].content);setGlobals("glo_url_array",newResp[i].url);setGlobals("glo_icon_array",newResp[i].icon);setGlobals("glo_category_array",newResp[i].category);setGlobals("glo_updated_array",newResp[i].updated);setGlobals("glo_published_array",newResp[i].published);setGlobals("glo_author_array",newResp[i].author);setGlobals("glo_thumb_array",newResp[i].icon);if(newResp[i].tags){setGlobals("glo_tags_array",newResp[i].tags)}if(newResp[i].description){setGlobals("glo_description_array",newResp[i].description)}}setValues()}var Url={encode:function(a){return escape(this._utf8_encode(a))},decode:function(a){return this._utf8_decode(unescape(a))},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};function setValues(){if(glo_guid_index!==null&&glo_url_array.length>0){setGlobals("url",glo_url_array[glo_guid_index]);setGlobals("title",glo_title_array[glo_guid_index]);setGlobals("type",glo_type_array[glo_guid_index]);setGlobals("summary",glo_summary_array[glo_guid_index]);setGlobals("content",glo_content_array[glo_guid_index]);setGlobals("icon",glo_icon_array[glo_guid_index]);setGlobals("category",glo_category_array[glo_guid_index]);setGlobals("updated",glo_updated_array[glo_guid_index]);setGlobals("published",glo_published_array[glo_guid_index]);setGlobals("author",glo_author_array[glo_guid_index]);setGlobals("glo_tags",glo_tags_array[glo_guid_index]);setGlobals("glo_thumb",glo_thumb_array[glo_guid_index]);setGlobals("glo_description",glo_description_array[glo_guid_index]);createSwList();widget.fireEvent("shareableValuesUpdated");if(glo_ads==true){var a=(new Date()).getTime();if(glo_adtag_header!=""){$("header_ad").set("html",glo_adtag_header.replace(/\[timestamp\]/g,a))}if(glo_adtag_footer!=""){$("footer_ad_body").set("html",glo_adtag_footer.replace(/\[timestamp\]/g,a))}}}}function searchName(b){var e=[];var f=new RegExp("^"+b);for(var d=0;d<widget.user.contacts.length&&e.length<widget.maxContactSearchResults;d++){var a=widget.user.contacts[d].name.toLowerCase();if(f.test(a)){e.push(d)}}return e}function searchName2(b){var e=[];var f=new RegExp("^ "+b);for(var d=0;d<widget.user.contacts.length&&e.length<widget.maxContactSearchResults;d++){var a=widget.user.contacts[d].name.toLowerCase();if(f.test(a)){e.push(d)}}return e}function searchName3(e){var h=[];if(e.search(/ /)>=0){var d="";var a="";var b=e.toLowerCase();b=b.split(" ");if(b.length>1){d=b[0];a=b[1]}var j=new RegExp("^"+d);var f=new RegExp(" "+a,"gi");for(var g=0;g<widget.user.contacts.length&&h.length<widget.maxContactSearchResults;g++){b=widget.user.contacts[g].name.toLowerCase();if(j.test(b)&&f.test(b)){h.push(g)}}}return h}function searchName4(d){var f=[];var b="";var a="";d=d.toLowerCase();for(var e=0;e<widget.user.contacts.length&&f.length<widget.maxContactSearchResults;e++){tmp_name=widget.user.contacts[e].name.toLowerCase();var g=new RegExp(" "+d,"gi");if(g.test(tmp_name)){f.push(e)}}return f}function searchName5(e){var h=[];var d="";var a="";var b=e.toLowerCase();if(b.length>1){d=b[0];a=b.substring(1)}var j=new RegExp("^"+d);var f=new RegExp(" "+a,"gi");for(var g=0;g<widget.user.contacts.length&&h.length<widget.maxContactSearchResults;g++){b=widget.user.contacts[g].name.toLowerCase();if(j.test(b)&&f.test(b)){h.push(g)}}return h}function searchAdd(e){var j=false;if(e>=0){var d="\\+?1?"+e+"[0-9]*";var h=new RegExp(d);j=true}else{if(e[0]=="@"){var h=new RegExp(e,"gi")}else{var h=new RegExp("^"+e)}}var g=0;var f=[];for(var g=0;g<widget.user.contacts.length&&f.length<widget.maxContactSearchResults;g++){var b=widget.user.contacts[g].address.toLowerCase();if(h.test(b)){f.push(g)}}return f}function txtGreyBox(b,m){var h=glo_contProto[b];var a=glo_contName[b];var d=glo_contAdd[b];var j=glo_contAdd[b];var g="greyBox_"+b;var e="addBox_"+b;var k="paren_"+g;var l="";var f="";if(h==="EMAIL"){h="E-mail"}if(h==="AIM"){h="AIM"}if(h==="SMS"){h="SMS"}if(glo_greyBoxNum%2===0){l+='<div id="'+k+'" class="boxRecipientsItem even">'}else{l+='<div id="'+k+'" class="boxRecipientsItem odd">'}l+='<span class="txtRecipientsItemDisplay">'+a+"</span>";l+='			<span class="txtRecipientsItemUsing">'+langTextArray.using+" "+h+"</span>";if(m===true&&glo_isLoggedIn===true){l+='	<div id="'+e+'" class="boxRecipientsItemAdd" onclick="showAddAnother(this);"/></div>'}l+='			<div id="'+g+'" class="boxRecipientsItemDelete" onclick="delGreyItem(this);"/></div>';l+="</div>";hideSuggest();return l}function delGreyItem(a){var e=document.getElementById("boxAddressList");var b=document.getElementById("paren_"+a.id);var f=a.id;f=f.replace(/greyBox_/,"");removeFromQueue(f);e.removeChild(b);if(glo_msgArray.length==0){$("boxAddressList").addClass("hidden")}}function hideSuggest(){$("boxToMessage").setStyle("z-index","10");$("boxToYourAddr").setStyle("z-index","10");$("txtTo").set("value","");glo_selected_item=0;$$(".activeItem").removeClass("activeItem")}function showSuggest(){$("boxToMessage").setStyle("z-index","1");$("boxToYourAddr").setStyle("z-index","1")}function hoverSelection(a){var b=a.id;$$(".activeItem").removeClass("activeItem");$(b).addClass("activeItem")}function addToSenders(a){var d=a.id;d=d.replace(/uniq_/,"");addToMsg(d);var b="";glo_greyBoxNum=$$("div[id^=paren_greyBox_]").length;b+=txtGreyBox(d);$("boxAddressList").set("html",$("boxAddressList").get("html")+b);$("boxAddressList").setStyle("display","block");hideSuggest();$("txtTo").value=""}function addToSenders2(b){addToMsg(b);var a="";glo_greyBoxNum=$$("div[id^=paren_greyBox_]").length;a+=txtGreyBox(b,true);$("boxAddressList").set("html",$("boxAddressList").get("html")+a);$("boxAddressList").setStyle("display","block");hideSuggest();$("txtTo").value=""}function clearMsgQueue(){glo_msgArray.empty()}function addToMsg(a){glo_msgArray.push(a)}function removeFromQueue(a){glo_msgArray.erase(a)}function processSendQueue(){var a=[];var b=[];glo_msgArray.each(function(d){if(d.service=="sms"){var e=d.address.replace(/[^\d]/g,"");if(e[0]!="1"){e="1"+e}d.address=e}a.push({type:d.service,name:d.name,address:d.address});b.push(d.service)});glo_destinations=b.join(",").toLowerCase();a=JSON.encode(a);createMessage(a)}function createMessage(b){glo_msgArray=[];var p=false;if(glo_isLoggedIn===false||widget.user.email.length<3){var e=$("txtYourAddr").value;if(isEmail(e)){glo_userEmail=e}else{alert(langTextArray.msg_enter_email);p=true}}if(!b.length){alert(langTextArray.msg_enter_recip);p=true}var k=glo_userEmail;var d=glo_title;try{d=decodeURIComponent(glo_title)}catch(f){}var m=d;if(glo_url==""||glo_url=="undefined"||glo_url==undefined){glo_url=glo_pUrl}if(m==""||m=="undefined"){m=decodeURIComponent(glo_url)}glo_type="";var l=$("txtMessage").value;var a=glo_publisher;glo_content=Url.decode(glo_content);glo_content=encodeURIComponent(glo_content);if(!glo_description||glo_description==undefined||glo_description=="undefined"){glo_description=""}if(!glo_summary||glo_summary==undefined||glo_summary=="undefined"){glo_summary=""}if(!glo_tags||glo_tags=="undefined"){glo_tags=""}var o=[];o[0]={type:glo_type,url:glo_url,title:glo_title,thumbnail:glo_thumb,embed:glo_content,description:glo_summary,tags:glo_tags};o=JSON.encode(o);var n=null;var h=null;try{n=Recaptcha.get_challenge();h=Recaptcha.get_response()}catch(f){}var j="sender="+encodeURIComponent(k)+"&subject="+encodeURIComponent(m)+"&comment="+encodeURIComponent(l)+"&publisher="+a+"&objects="+encodeURIComponent(o)+"&recipients="+encodeURIComponent(b)+"&sessionID="+glo_sessionID+"&return=JSON&captcha_challenge="+encodeURIComponent(n)+"&captcha_response="+encodeURIComponent(h);if(glo_widget_info){j=j+"&session_token="+glo_widget_info.session_token}if(!p){var g=new Request({method:"post",url:"/api/createMessage_ws.php",data:j,onFailure:function(){logError("createMessage","Ajax Failure")},onSuccess:createMessage_onSuccess});g.send();widget.fireEvent("createMessageRequested")}}function createMessage_onSuccess(b,e){logEvent(glo_destinations,"share");try{var d=JSON.decode(b)}catch(a){logError("createMessage",b)}if(d.status==="SUCCESS"){emptyInputs();glo_msgArray=[];if(d.data.require_captcha){glo_widget_info.require_captcha=d.data.require_captcha}widget.fireEvent("createMessageSucceeded")}else{logError("createMessage",JSON.encode(d));widget.fireEvent("createMessageFailed",d.statusMessage)}}var glo_selected_item=0;function selectActive(d){$$(".activeItem").removeClass("activeItem");var b=document.getElementById(d);b.addClass("activeItem")}function determineType(e,d){if(e!==""){var a="";var g=0;var b=$("txtUsing").value;if(b==="ALL"){if(isEmail(e)){a="EMAIL"}else{if(isAIM(e)){a="AIM"}else{if(isPhone(e)){a="SMS"}}}}else{if(b==="SMS"){if(isPhone(e)){a="SMS"}else{if(!d){alert(langTextArray.msg_phone_no)}a="";document.getElementById("txtTo").value=""}}else{if(b==="EMAIL"){if(isEmail(e)){a="EMAIL"}else{a="";if(!d){alert(langTextArray.msg_email_invalid)}}}}}if(document.getElementById("txtTo").value!==""&&(a=="EMAIL"||a=="AIM"||a=="SMS")&&a!=="undefined"&&a!==undefined){setGlobals("contProto",a);setGlobals("contName",e);setGlobals("contAdd",e);var f=glo_contAdd.length-1;return f}else{return false}if(!d){document.getElementById("txtTo").focus()}}}function isEmail(a){if(a.match(/^[_a-zA-Z0-9-]+(\.[_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.(([0-9]{1,3})|([a-zA-Z]{2,3})|(aero|coop|info|museum|name))$/)){return true}else{return false}}function isPhone(a){a=a.replace(/[^\d]/g,"");if(a.length===10||a.length===11){if(a.match(/^1?[2-9]\d{9}$/)){return true}else{return false}}else{return false}}function getDiggs(a){if(a!==""&&a!==" "&&a!==glo_last_url&&a!=="undefined"&&a!==undefined){var d="url="+encodeURIComponent(a)+"&fpc="+glo_fpc;var b=new Request({method:"post",url:"/api/initWidget_ws.php",data:d,onFailure:function(){logError("get diggs","Ajax Failure")},onSuccess:getDiggs_onSuccess});glo_last_url=a;b.send()}}function getDiggs_onSuccess(d,f){try{var e=JSON.decode(d)}catch(b){logError("get diggs",d)}glo_widget_info=e.data;glo_num_diggs=widget.nDiggs=e.data.diggs;glo_digg_comments=widget.nDiggComments=e.data.comments;var a=$("post_digg_link");a.set("title",widget.nDiggs+" Diggs, "+widget.nDiggComments+langTextArray.msg_comments);a.set("text","Digg ("+widget.nDiggs+")")}function getRelatedShares(a){var d="url="+a+"&count=3&fb=0&comments=0&fuzzy=0";var b=new Request({method:"post",url:"/api/getShareStream_ws.php",data:d,onFailure:function(){logError("get related shares","Ajax Failure")},onSuccess:getRelatedShares_onSuccess});b.send()}function getRelatedShares_onSuccess(h,j){try{var e=JSON.decode(h)}catch(f){logError("get related shares",h)}if(e&&e.urls&&e.url_count>0){for(var g=0;g<e.urls.length&&g<3;g++){var d=new Element("div",{"class":"relatedShare"});if(e.urls[g].img!=""){d.addClass("hasImage");var k="";if(e.urls[g].img.search(/http:/)!=-1){k=e.urls[g].img}else{if(e.urls[g].img=="f5cdf97c374b31675d43285b73db4deb"){k="http://sharethis.com/share/thumb?url="+encodeURIComponent(e.urls[g].url)}else{k="http://img.sharethis.com.s3.amazonaws.com/"+e.urls[g].img+"/100_100.png"}}d.set("html",d.get("html")+'<div class="relatedImg"><img src="'+k+'" onclick="window.open(\''+e.urls[g].url+"','external','resizable=1,location=1,status=1,scrollbars=1,toolbar=1'); return false;\" /></div>")}var b=new Element("div",{"class":"relatedDetails"});b.set("html",b.get("html")+'<span class="relatedTitle link" onclick="window.open(\''+e.urls[g].url+"','external','resizable=1,location=1,status=1,scrollbars=1,toolbar=1'); return false;\" title=\""+e.urls[g].title+'">'+e.urls[g].title+"</span>");if(widget.extractDomainFromURL(e.urls[g].url)!=widget.extractDomainFromURL(glo_url)){b.set("html",b.get("html")+'<span class="relatedSource">Source: '+widget.extractDomainFromURL(e.urls[g].url)+"</span>")}b.set("html",b.get("html")+'<span class="relatedShareCount">'+e.urls[g].shares+" share"+((e.urls[g].shares==1)?"":"s")+"</span>");b.inject(d);if(g<2){d.set("html",d.get("html")+'<span class="divider"></span>')}d.inject("doneRelatedShares")}}else{$("doneRelated").addClass("hidden");var a=Math.floor(Math.random()*3)+1;switch(a){case 1:$("doneToolbar").removeClass("hidden");break;case 2:$("doneRegister").removeClass("hidden");break;case 3:$("doneGetButton").removeClass("hidden");break}}}function addHashTracking(d){if(glo_hash_flag&&(!d.match("#")&&glo_sessionID!=null)){var a=glo_sessionID.split(".");var b=parseFloat(a[0]).toString(36)+"."+parseFloat(a[1]).toString(36);return d+"#STS="+b+"&shr=1"}else{return d}}function createSharURL(a,d){if(a!==""&&a!==" "&&a!==glo_last_url2&&a!==undefined&&a!=="undefined"){var e="url="+encodeURIComponent(addHashTracking(a))+"&sessionID="+glo_sessionID+"&fpc="+glo_fpc;var b=new Request({method:"post",url:"/api/createSharURL_ws.php",data:e,onFailure:function(){logError("createSharURL","Ajax Failure")},onSuccess:createSharURL_onSuccess});if(d){b.options.async=false}glo_last_url2=a;$("post_message").disabled=true;$("post_message").value=langTextArray.msg_loading;b.send()}}function createSharURL_onSuccess(d,f){try{var e=JSON.decode(d);var a=e.data.sharURL}catch(b){logError("createSharURL",d);var a=glo_url}glo_sharURL=a;$("post_message").disabled=false;$("post_message").value=glo_title+" - "+glo_sharURL;widget.fireEvent("sharURLAcquired")}function getSharURL(){if(!glo_sharURL||glo_sharURL==undefined||glo_sharURL=="undefined"){return glo_url}else{return glo_sharURL}}var closetimeout;function suggestAutoClose(){closetimeout=setTimeout("hideSuggest()",750)}function suggestCancelClose(){if(closetimeout){clearTimeout(closetimeout)}}function sendDestination(f){var h=glo_destinationAddress;glo_type="default";glo_content=Url.decode(glo_content);glo_content=encodeURIComponent(glo_content);if(glo_url==""||glo_url=="undefined"||glo_url==undefined){glo_url=glo_pUrl}if(!glo_description||glo_description==undefined||glo_description=="undefined"){glo_description=""}if(!glo_tags||glo_tags=="undefined"){glo_tags=""}var b=glo_title;try{b=decodeURIComponent(glo_title)}catch(d){}var l="";var j="";if(f=="twitter.com"){l=[{type:glo_type,url:glo_url,sharURL:getSharURL(),title:b,thumbnail:glo_thumb,embed:glo_content,description:glo_description,tags:glo_tags}]}else{l=[{type:glo_type,url:glo_url,title:b,thumbnail:glo_thumb,embed:glo_content,description:glo_description,tags:glo_tags}]}l=JSON.encode(l);j=[{type:f,address:h}];j=JSON.encode(j);var e="";if(glo_userEmail==""){e=""}else{e="&sender="+encodeURIComponent(glo_userEmail)}var g="publisher="+glo_publisher+"&objects="+encodeURIComponent(l)+"&destinations="+encodeURIComponent(j)+"&destinationType="+glo_destinationType+"&sessionID="+glo_sessionID+"&return=json"+e;var a="/api/createDestination_ws.php?"+g;var k=new Image(1,1);k.src=a;k.onload=function(){return}}function populateSavedCredentials(a){if(typeof(glo_credentials)=="undefined"||glo_credentials.length<1){return}for(var b=0;b<=glo_credentials.length;b++){if(glo_credentials[b]&&glo_credentials[b].service==a){try{$("post_remember_me").checked=true;if(!$("post_url").hasClass("hidden")){widget.freezeTextInput($("post_url"));$("post_url").value=glo_credentials[b].url}widget.freezeTextInput($("post_username"));widget.freezeTextInput($("post_password"));$("post_username").value=glo_credentials[b].username;$("post_password").value=glo_credentials[b].password}catch(d){}}}}function logError(e,d){var b="http://l.sharethis.com/error?event="+e+"&publisher="+encodeURIComponent(glo_publisher)+"&ts"+(new Date()).getTime()+"&title="+encodeURIComponent(glo_title)+"&url="+encodeURIComponent(cleanURL(glo_url))+"&pUrl="+encodeURIComponent(glo_pUrl)+"&error="+encodeURIComponent(d)+"&sessionID="+glo_sessionID+"&fpc="+glo_fpc;var a=new Image(1,1);a.src=b;a.onload=function(){return}}function odjs(a,b){this.head=document.getElementsByTagName("head")[0];this.scriptSrc=a;this.script=document.createElement("script");this.script.setAttribute("type","text/javascript");this.script.setAttribute("src",this.scriptSrc);this.script.onload=b;this.script.onreadystatechange=function(){if(this.readyState=="loaded"){b()}};this.head.appendChild(this.script)}function checkForLoginCookie(){var a=widget.getCookie("ShareUT");if(a){clearInterval(glo_login_poller);widget.user.acquireAuth(a);clearInterval(glo_login_poller)}}function checkForImportCookie(){var a=widget.getCookie("StImported");var b=widget.getCookie("ShareUT");if(b&&a){clearInterval(glo_import_poller);widget.user.acquireAuth(b);clearInterval(glo_import_poller)}}Widget.Page=new Class({Implements:Events,id:"",pages:{},widget:null,domContainer:null,shown:false,firstShow:true,initialize:function(b,a){this.widget=b;if(a){for(var d in a){if(typeof a[d]!="function"){this[d]=a[d]}}}if(this.id.length){this.domContainer=$(this.id)}if(this.pages){this.pages=b.initializePages(this.pages)}},onShow:function(){this.shown=true;if(this.firstShow){this.firstShow=false}},onHide:function(){this.shown=false},isShown:function(){return this.shown},onReady:function(){},bindReturnKeyToSubmission:function(){this.domContainer.getElements("input[type=text], input[type=password]").each((function(a){a.addEvent("keyup",(function(b){if(b.key=="enter"&&!widget.showingAlert){this.submitForm()}}).bind(this))}).bind(this))},post_bindReturnKeyToSubmission:function(a){$("post_template").getElements("input[type=text], input[type=password]").each((function(b){b.removeEvents("keyup");b.addEvent("keyup",(function(d){if(d.key=="enter"&&!widget.showingAlert){widget.pages.post.pages[a].submitForm()}}).bind(this))}).bind(this))},submitForm:function(){},bindHelpText:function(a,d){var b=a.getStyle("color");if(!a.get("value").length){a.set("value",d);a.setStyle("color","#888")}a.addEvent("blur",(function(){if(!this.get("value").length){this.set("value",d);this.setStyle("color","#888")}}).bind(a));a.addEvent("focus",(function(){if(this.get("value")==d){this.set("value","");this.setStyle("color",b)}}).bind(a))}});Widget.implement({pages:{home:{id:"home_page",onShow:function(){this.parent()},onHide:function(){this.parent()},onReady:function(){$("twitter_update_status").addEvent("click",function(a){a.stop()});widget.user.addEvent("infoChanged",(function(){createSwList()}).bind(this));widget.carousel=this.carousel=new Widget.Carousel(this.domContainer.getElement(".carousel"),(!glo_tabArray.contains("email")?Widget.Carousel.initialState_more:Widget.Carousel.initialState_less));this.parent()}},sharebox:{id:"sharebox_page",onReady:function(){$("sharebox_submit").addEvent("click",function(a){gaLog("Sharebox","save_click",$("sharebox_tags").get("value"));widget.saveToShareBox($("sharebox_tags").get("value"));a.stop()});if(glo_tags_array&&glo_tags_array.length){$("sharebox_tags").set("value",glo_tags_array.join(","))}widget.addEvent("shareableURLChanged",(function(a){if(a==""){a=glo_url}var b=widget.extractDomainFromURL(a);$("sharebox_previewUrl").set("text",b);if(a.length){$("sharebox_previewThumb").removeClass("hidden");$("sharebox_previewThumb").set("src",glo_thumbImageTag)}else{$("sharebox_previewThumb").addClass("hidden")}$("sharebox_preview").removeClass("hidden")}).bind(this));widget.addEvent("shareableTitleChanged",(function(b){try{b=decodeURIComponent(b)}catch(a){}$("sharebox_previewTitle").set("text",b)}).bind(this));widget.addEvent("shareableDescriptionChanged",(function(a){$("sharebox_previewDescription").set("text",a)}).bind(this));this.parent();widget.addEvent("saveToShareBoxSucceeded",function(){widget.showPage("done");$("done_message").set("text",langTextArray.msg_item_saved)});widget.addEvent("saveToShareBoxFailed",function(){widget.pushModalErrorSheet(langTextArray.msg_not_save_sharebox)})},onShow:function(){if(this.firstShow){this.bindHelpText($("sharebox_tags"),langTextArray.msg_seprated_comma)}widget.user.addEvent("signedOut",this.runAway.bind(this));this.parent()},onHide:function(){widget.user.removeEvent("signedOut",this.runAway.bind(this))},runAway:function(){if(glo_page=="send"||glo_page=="post|twitter"){widget.showPage(glo_page)}else{widget.showPage("home")}}},send:{id:"send_page",toField:null,_resizeShortcutsOnShow:false,buildShortcutList:function(b){$("recent_recipients").getChildren().each(function(a){if(a.nodeName.toLowerCase()!="h4"){a.destroy()}});for(var f=0;f<3&&f<b.length;f++){var g=new Element("span",{"class":"shortcut"});var d=new Element("a",{href:"#",title:b[f].address+" ("+b[f].service+")"});d.set("html",b[f].name);d.addEvent("click",(function(){gaLog("Send","recents_click",f+1,f+1);var a=b[f];return(function(j){var h=widget.user.searchContactsExact(a.service.toLowerCase(),a.address);if(h){h.select()}else{var e=widget.user.addContactsLocally([a]);setTimeout(function(){e[0].select()},1)}j.stop()})})());$("recent_recipients").grab(g.grab(d))}if(this.isShown()){this.resizeShortcuts()}else{if(b.length){this._resizeShortcutsOnShow=true}else{$("recent_recipients").addClass("hidden")}}},hideShortcutList:function(){$("recent_recipients").getChildren().each(function(a){if(a.nodeName.toLowerCase()!="h4"){a.destroy()}});$("recent_recipients").addClass("hidden")},resizeShortcuts:function(){$("recent_recipients").removeClass("hidden");$("recent_recipients").getChildren().getLast().addClass("last");var b=[];var a=0;$("recent_recipients").getChildren().each(function(g){var e=g.getElement("a");var f=g.getSize().x;if(e){b.push({anchor:e,width:f})}a+=f});while(a>295){b.sort(function(f,e){return e.width-f.width});var d=b[0].anchor.get("html");b[0].anchor.set("html",d.substring(0,d.length-3)+"&hellip;");b[0].width=b[0].anchor.getSize().x;a=0;$("recent_recipients").getChildren().each(function(e){a+=e.getSize().x})}},updateCharacterCounter:function(){var a=widget.maxSendMessageLength;if(this.hasTwitterRecipients()){a=140;$("boxToYourAddrInfo").style.display="block"}if(glo_browser.test("ie7")){$$(".character_counter").setStyle("display","none")}else{$("spanMessageCounter").set("html",a-$("txtMessage").value.length)}},hasTwitterRecipients:function(){var b=false;var a=widget.user.getSelectedContacts();a.each(function(d){if((d.service&&d.service.toLowerCase()=="twitter")||(d.type&&d.type.toLowerCase()=="twitter")){b=true}});return b},onShow:function(){if(this.firstShow){this.bindHelpText($("txtYourAddr"),langTextArray.msg_your_email)}this.updateCharacterCounter();$("privacyLink").removeClass("hidden");this.parent();this.toField.onPageShown();if(this._resizeShortcutsOnShow){this.resizeShortcuts();this._resizeShortcutsOnShow=false}if(glo_widget_info.require_captcha){if(typeof(Recaptcha)=="undefined"){odjs("http://api.recaptcha.net/js/recaptcha_ajax.js",function(){Recaptcha.create("6Leh9AIAAAAAAHYpIPrfzeRFMrHC2QysVPB93Qhh","captcha")})}else{Recaptcha.create("6Leh9AIAAAAAAHYpIPrfzeRFMrHC2QysVPB93Qhh","captcha")}gaLog("Send","captcha_shown","require_captcha flag set")}},onHide:function(){this.parent();$("privacyLink").addClass("hidden");widget.user.contactServiceFilters=[];this.toField.onPageHidden()},onReady:function(){this.toField=new Widget.ToField(widget,$("send_to_field"));$("previewCloseLink").addEvent("click",function(a){gaLog("Send","preview_close_click");$("preview").addClass("hidden");$("linkPreview").removeClass("hidden");$("previewCloseLink").addClass("hidden");a.stop()});$("linkPreview").addEvent("click",function(a){gaLog("Send","preview_open_click");$("preview").removeClass("hidden");$("previewThumb").set("html","<img width='100' src='"+glo_thumbImageTag+"'/>");$("linkPreview").addClass("hidden");$("previewCloseLink").removeClass("hidden");a.stop()});$("btnShareSend").addEvent("click",(function(){gaLog("Send","send_btn_click");var a=widget.user.getSelectedContacts();if($("contact_search_field")){if($("contact_search_field").value.length>0){widget.pages.send.toField._selectHighlightedResult();widget.pages.send.toField.hideSearchResults()}}if(a.length<1){alert(langTextArray.msg_enter_recipto)}else{if(a.length<25){a.each(function(b){addToMsg(b)});processSendQueue()}else{alert(langTextArray.msg_less_recip)}}}).bind(this));$("txtMessage").addEvent("keypress",(function(f){f=new Event(f);var d=true;var b=$("txtMessage");var a=widget.maxSendMessageLength;if(glo_sharURL&&this.hasTwitterRecipients()){a=140}if(glo_browser.test("ie7")){$$(".character_counter").setStyle("display","none")}else{var e=$("spanMessageCounter");d=widget.limitCharacters(b,a,e,f);return d}}).bind(this));$("txtMessage").addEvent("keyup",(function(){this.updateCharacterCounter()}).bind(this));widget.user.addEvent("signedIn",function(){if(widget.user.email.length>3){$("from_box").addClass("hidden")}});widget.user.addEvent("signedOut",function(){$("from_box").removeClass("hidden")});widget.addEvent("createMessageRequested",(function(){widget.pushModalWorkingSheet();if(glo_widget_info.require_captcha){Recaptcha.destroy()}}).bind(this));widget.addEvent("createMessageSucceeded",(function(){widget.popModalWorkingSheet();widget.showPage("done");widget.user.getUserAccountInfo()}).bind(this));widget.addEvent("createMessageFailed",(function(){widget.popModalWorkingSheet();widget.pushModalErrorSheet(langTextArray.msg_not_sent);if(glo_widget_info.require_captcha){if(typeof(Recaptcha)=="undefined"){odjs("http://api.recaptcha.net/js/recaptcha_ajax.js",function(){Recaptcha.create("6Leh9AIAAAAAAHYpIPrfzeRFMrHC2QysVPB93Qhh","captcha",{callback:Recaptcha.focus_response_field})})}else{Recaptcha.create("6Leh9AIAAAAAAHYpIPrfzeRFMrHC2QysVPB93Qhh","captcha",{callback:Recaptcha.focus_response_field})}gaLog("Send","captcha_shown","message failed")}}).bind(this));widget.user.addEvent("recipientHistoryChanged",(function(a){widget.deferWhile("recipientHistoryIsChanging",(function(){if(widget.user.isSignedIn()&&glo_tabArray.contains("email")){this.buildShortcutList(a.recipients)}}).bind(this))}).bind(this));widget.user.addEvent("signedOut",(function(){this.hideShortcutList()}).bind(this));this.parent()}},account_linking:{id:"account_linking_page",onReady:function(){$("account_linking_details").grab(new Element("label",{"class":"login_label",text:langTextArray.username}));$("account_linking_details").grab(new Element("input",{id:"account_linking_username",type:"text","class":"text",value:""}));$("account_linking_details").grab(new Element("label",{"class":"login_label",text:langTextArray.password}));$("account_linking_details").grab(new Element("input",{id:"account_linking_password",type:"password","class":"text",value:""}));$("account_linking_skip").addEvent("click",(function(a){gaLog("Account_Link","account_link_skip_btn_click");widget.pages.login.processAccountLinking(true)}).bind(this));$("account_linking_submit").addEvent("click",(function(a){gaLog("Account_Link","account_link_submit_btn_click");widget.pages.login.processAccountLinking(false)}).bind(this))},onShow:function(){if(glo_thirdparty_existing_email!=""){$("account_linking_info").set("html",langTextArray.acc_linking_info);$("account_linking_username").set("text",glo_thirdparty_existing_email)}else{$("account_linking_info").set("html",langTextArray.yahoo_linking_info)}}},done:{id:"done_page",onReady:function(){$("doneScreenOk").addEvent("click",function(a){widget.user.deselectContacts();clearMsgQueue();if(glo_page=="send"||glo_page=="post|twitter"){widget.showPage(glo_page)}else{widget.showPage("home")}a.stop()});this.parent()},onShow:function(){$("doneRelatedShares").empty();$("doneRelated").removeClass("hidden");$("doneToolbar").addClass("hidden");$("doneRegister").addClass("hidden");$("doneGetButton").addClass("hidden");getRelatedShares(glo_url);var d="http://sharethis.com/stream?src="+widget.extractDomainFromURL(glo_url);var b=new Element("a",{rel:"external",style:"color:#fff;",target:"_blank",href:d});b.addEvent("click",(function(a){gaLog("Footer","livestream_link","See what your friends are sharing");if(glo_options_popup==true){popupOpen2(this);return false}}).bind(b));$("livestream_link").set("html","");$("livestream_link").appendChild(b);b.appendText("See what your friends are sharing");$("livestream_link").setStyle("display","block")},onHide:function(){$("done_message").set("text",langTextArray.msg_shared);$("livestream_link").set("style","")}},post:{id:"post_page",onShow:function(){$("privacyLink").removeClass("hidden")},onHide:function(){$("privacyLink").addClass("hidden");this.parent()},onReady:function(){widget.addEvent("postToServiceRequested",function(a){widget.pushModalWorkingSheet('<span class="'+a+'">'+langTextArray.msg_posting_share+" "+widget.services[a].title+"</span>")});widget.addEvent("postToServiceSucceeded",function(a){logEvent(a,"post");widget.popModalWorkingSheet();widget.showPage("done")});widget.addEvent("postToServiceFailed",function(b,a){widget.popModalWorkingSheet();widget.pushModalErrorSheet(a)});this.parent()},pages:{blogger:{id:"post_template",desc:"",onReady:function(){this.parent()},onShow:function(){$("post_desc").set("html",langTextArray.msg_posting_blog);widget.addEvent("postToServiceNeedsMoreInfo",function(e,f,g){var h=[];var d=[];var a="";for(var b=0;b<g.blogs.length;b++){h.push(g.blogs[b].blogname);d.push(g.blogs[b].blogid)}a='<select id="post_select">';for(b=0;b<h.length;b++){a+='<option value="'+d[b]+'">'+h[b]+"</option>"}a+="</select>";this.freezeTextInput($("post_username"));this.freezeTextInput($("post_password"));$("post_publish_btn").removeClass("hidden");$("post_draft_btn").addClass("hidden");$("post_submit_btn").addClass("hidden");$("post_select_container").set("html",a);$("post_select_box").removeClass("hidden");widget.popModalWorkingSheet();widget.displayNotification(f)});$("post_draft_btn").addEvent("click",function(){gaLog("Post","draft_btn_click","blogger");setGlobals("glo_bloggerDraft",0);widget.postBlogger()});$("post_submit_btn").addEvent("click",function(){gaLog("Post","post_btn_click","blogger");setGlobals("glo_bloggerDraft",1);widget.postBlogger()});$("post_publish_btn").addEvent("click",function(){gaLog("Post","submit_btn_click","blogger");widget.postBlogger()});this.post_bindReturnKeyToSubmission("blogger")},submitForm:function(){setGlobals("glo_bloggerDraft",1);widget.postBlogger()}},livejournal:{id:"post_template",desc:"",onReady:function(){},onShow:function(){$("post_desc").set("html",langTextArray.msg_lovejournal);$("post_message").value=langTextArray.msg_optional;$("post_message").addEvent("focus",function(){if($("post_message").value===langTextArray.msg_optional){$("post_message").value=""}});$("post_submit_btn").addEvent("click",function(){gaLog("Post","post_btn_click","livejournal");widget.postLive_journal()});this.post_bindReturnKeyToSubmission("livejournal");this.parent()},submitForm:function(){widget.postLive_journal()}},twitter:{id:"post_template",desc:"",statusMessage:null,onReady:function(){widget.addEvent("twitterClicked",(function(){var d=glo_title;try{d=decodeURIComponent(glo_title)}catch(b){}this.statusMessage=d+" - "+getSharURL();var a=0;while(this.statusMessage.length>140){this.statusMessage=glo_title.substr(0,glo_title.length-a++)+"... "+getSharURL()}$("post_message").value=this.statusMessage;this.updateCharacterCounter()}).bind(this));this.parent()},onShow:function(){$("post_desc").set("html",langTextArray.post_twitter);$("post_message").addEvent("keypress",(function(f){f=new Event(f);var d=true;var b=$("post_message");var a=140;var e=$("post_character_counter");if("enter"===f.key&&status.length<=140){widget.postTwitter()}else{d=widget.limitCharacters(b,a,e,f)}return d}).bind(this));$("post_message").addEvent("keyup",(function(){this.statusMessage=$("post_message").value;this.updateCharacterCounter()}).bind(this));$("post_submit_btn").addEvent("click",function(){gaLog("Post","post_btn_click","twitter");widget.postTwitter()});this.post_bindReturnKeyToSubmission("twitter");$("post_message").value=this.statusMessage;this.updateCharacterCounter();createSharURL(glo_url)},updateCharacterCounter:function(){$("post_character_counter").set("html",140-$("post_message").value.length)},submitForm:function(){widget.postTwitter()}},typepad:{id:"post_template",desc:"",onReady:function(){this.parent()},onShow:function(){$("post_desc").set("html",langTextArray.msg_post_typepad);widget.addEvent("postToServiceNeedsMoreInfo",function(e,f,g){if(e=="typepad"){var h=[];var d=[];var a="";for(var b=0;b<g.blogs.length;b++){h.push(g.blogs[b].blogName);d.push(g.blogs[b].blogid)}a="<select id='post_select'>";for(b=0;b<h.length;b++){a+='<option value="'+d[b]+'">'+h[b]+"</option>"}a+="</select>";this.freezeTextInput($("post_username"));this.freezeTextInput($("post_password"));$("post_publish_btn").removeClass("hidden");$("post_draft_btn").addClass("hidden");$("post_submit_btn").addClass("hidden");$("post_select_container").set("html",a);$("post_select_box").removeClass("hidden");widget.popModalWorkingSheet();widget.displayNotification(f)}});$("post_draft_btn").addEvent("click",function(){gaLog("Post","draft_btn_click","typepad");setGlobals("glo_tpDraft",0);widget.postTypePad()});$("post_submit_btn").addEvent("click",function(){gaLog("Post","post_btn_click","typepad");setGlobals("glo_tpDraft",1);widget.postTypePad()});$("post_publish_btn").addEvent("click",function(){gaLog("Post","submit_btn_click","typepad");widget.postTypePad()});this.post_bindReturnKeyToSubmission("typepad")},submitForm:function(){setGlobals("glo_tpDraft",0);widget.postTypePad()}},wordpress:{id:"post_template",desc:"",onReady:function(){this.parent()},onShow:function(){$("post_desc").set("html",langTextArray.msg_post_wordpress);$("post_submit_btn").addEvent("click",function(){gaLog("Post","post_btn_click","wordpress");widget.postWordpress()});this.post_bindReturnKeyToSubmission("wordpress")},submitForm:function(){widget.postWordpress()}}}}},pageHistory:[],_currentPage:null,showSharebox:function(){},showPage:function(f,e,b){if(f==null){return}if(!e&&f!=this.pageHistory.getLast()){this.pageHistory.push(f)}f=(typeof f=="string"?f.split("|"):f);e=(e?e:widget);var d=f.shift();if(d=="null"){return}if(b){this.fireEvent("pageShown",e.pages[d])}else{for(var a in e.pages){if(a==d){$(e.pages[a].id).removeClass("hidden");this.fireEvent("pageShown",e.pages[a]);this._currentPage=e.pages[a]}else{if(!$(e.pages[a].id).hasClass("hidden")){$(e.pages[a].id).addClass("hidden");this.fireEvent("pageHidden",e.pages[a])}}}}if(f.length){if(d=="post"){this.initPost(f[0]);this.showPage(f,e.pages[d],true)}else{this.showPage(f,e.pages[d],false)}}},initPost:function(d){glo_post_page=d;$("post_url").set("value","");$("post_username").set("value","");$("post_password").set("value","");$("post_message").set("value","");$("post_remember_me").checked=false;$("post_forget_me").checked=false;this.unfreezeTextInput($("post_url"));this.unfreezeTextInput($("post_username"));this.unfreezeTextInput($("post_password"));$("post_url").disabled=false;$("post_username").disabled=false;$("post_password").disabled=false;$("post_message").removeEvents("focus");$("post_message").removeEvents("keypress");$("post_message").removeEvents("keyup");widget.removeEvents("postToServiceNeedsMoreInfo");if(document.getElementById("post_select")){$("post_select_container").empty()}var b=new Array("post_url_box","post_message_box","post_character_counter_div","post_select_box","post_draft_btn","post_submit_btn","post_publish_btn");b.each(function(e){if(!$(e).hasClass("hidden")){$(e).addClass("hidden")}});var a=new Array("post_submit_btn","post_draft_btn","post_submit_btn");a.each(function(e){$(e).removeEvents("click")});$("post_title").set("html",widget.services[d].title);$("post_title").set("class",d);$("post_desc").set("html",widget.pages.post.pages[d].desc);switch(d){case"twitter":$("post_message_label").set("html",langTextArray.email_message);$("post_character_counter_div").removeClass("hidden");$("post_message_box").removeClass("hidden");$("post_submit_btn").removeClass("hidden");$("post_username_box").addClass("hidden");$("post_password_box").addClass("hidden");$("remember_box").addClass("hidden");break;case"livejournal":$("post_message_label").set("html",langTextArray.msg_comment);$("post_message_box").removeClass("hidden");$("post_submit_btn").removeClass("hidden");break;case"blogger":$("post_draft_btn").removeClass("hidden");$("post_submit_btn").removeClass("hidden");break;case"wordpress":$("post_url_box").removeClass("hidden");$("post_submit_btn").removeClass("hidden");break;case"typepad":$("post_draft_btn").removeClass("hidden");$("post_submit_btn").removeClass("hidden");break}populateSavedCredentials(d)},showPreviousPage:function(){if(this.pageHistory.length>1){this.pageHistory.pop();this.showPage(this.pageHistory.getLast())}},hideOverlays:function(){$$(".overlay").addClass("hidden")},initializePages:function(e){var b={};for(var a in e){var d=new Class($extend({Extends:Widget.Page},e[a]));b[a]=new d(this);this.addEvent("pageShown",(function(f){return function(g){if(g==f){g.onShow()}}})(b[a]),true);this.addEvent("pageHidden",(function(f){return function(g){if(g==f){g.onHide()}}})(b[a]),true)}return b},readyPages:function(b){for(var a in b){b[a].onReady();if("pages" in b[a]){this.readyPages(b[a].pages)}}},getCurrentPage:function(){return this._currentPage},getCurrentTopLevelPage:function(){for(var a in widget.pages){if(widget.pages[a].isShown()){return widget.pages[a]}}return null},_lastFocus:null,captureLastFocus:function(a){this._lastFocus=a},getCurrentFocus:function(){return this._lastFocus},_modalCovers:[],_workingCovers:[],displayNotification:function(e){var d=widget.getCurrentTopLevelPage();if(d!=null){var a=d.domContainer;var b=new Element("div",{"class":"notification_sheet collapsed"});b.grab(new Element("div",{style:"font-weight:bold; text-align:center; margin:5px auto; width:337x"}).set("html",e));a.grab(b);setTimeout(function(){b.get("tween").addEvent("complete",function(){b.destroy()});b.set("tween",{duration:"normal"});b.tween("height","0px");setTimeout(function(){b.destroy()},1000)},2500);b.set("tween",{duration:"short"});b.tween("height","30px")}},pushModalSheet:function(l,g,h){var d=$("container");var k=new Element("div",{"class":"modal_sheet faded_out"});var b=new Element("div",{"class":"smoke"});var e=new Element("div",{"class":"modal_message_container"});var j=d.getSize().y-(2*parseInt(d.getStyle("border-width")));k.grab(b);k.setStyles("height",j);b.setStyle("height",j);e.grab(new Element("div",{"class":g}).set("html",l));e.grab(new Element("div",{"class":"button_new",html:"<span>"+langTextArray.btn_ok+"</span>"}).addEvent("click",function(m){widget.popModalSheet();if(typeof h=="function"){h()}m.stop()}));e.setStyles({height:j,top:"40px"});d.grab(k.grab(e));k.set("tween",{duration:"short"});var a=this.getCurrentFocus();if(a){a.blur()}var f=function(m){if(m.key=="enter"||m.key=="esc"){widget.popModalSheet()}};k.get("tween").addEvent("complete",function(){document.addEvent("keyup",f)});this._modalCovers.push({latentFocus:a,cover:k,keyHandler:f});k.fade("hide").fade("in")},popModalSheet:function(){if(this._modalCovers.length){var a=this._modalCovers.pop();document.removeEvent("keyup",a.keyHandler);a.cover.destroy();if(a.latentFocus){a.latentFocus.focus()}}},pushModalErrorSheet:function(a,b){this.pushModalSheet(a,"error",b)},pushModalNotificationSheet:function(b,a){this.pushModalSheet(b,"notification",a)},popModalNotificationSheet:function(){this.popModalSheet()},popModalErrorSheet:function(){this.popModalSheet()},pushModalWorkingSheet:function(g){var d=$("container");var e=new Element("div",{"class":"modal_sheet faded_out"});var f=new Element("div",{"class":"smoke"});var b=new Element("div",{"class":"spinner_container"});var a=d.getSize().y-(2*parseInt(d.getStyle("border-width")));e.grab(f);e.setStyles("height",a);f.setStyle("height",a);b.grab(new Element("div",{"class":"working_text"}).set("html",g));b.grab(new Element("div",{"class":"loading32"}));b.setStyles({height:a});d.grab(e.grab(b));e.set("tween",{duration:"short"});e.fade("hide").fade("in");this._workingCovers.push(e)},popModalWorkingSheet:function(){if(this._workingCovers.length){this._workingCovers.pop().destroy()}}});Widget.implement({services:{aim:{title:"AIM Share"},sms:{title:"Text",onClick:function(a){$("send_title").set("html",langTextArray.msg_text);widget.showPage("send");a.stop()},type:"sms"},email:{title:"Email",onClick:function(a){$("send_title").set("html",langTextArray.email);widget.showPage("send");a.stop()},type:"email"},sharebox:{title:"Save",onClick:function(a){if(widget.userIsSignedIn()){widget.fireEvent("shareableURLChanged",glo_thumb);widget.showPage("sharebox")}else{window.open("http://sharethis.com/account/signin-widget","LoginWindow","status=1, height=700, width=970, resizable=0");glo_login_poller=setInterval(checkForLoginCookie,1000)}a.stop()},type:"sharebox"},bebo:{title:"Bebo"},blinklist:{title:"Blinklist"},blogmarks:{title:"Blogmarks"},blogger:{title:"Blogger",onClick:function(a){widget.showPage("post|blogger");a.stop()},type:"post"},bus_exchange:{title:"Add to BX",aTitle:"Business Exchange"},care2:{title:"Care2"},current:{title:"Current"},dealsplus:{title:"Dealspl.us"},delicious:{title:"Delicious"},digg:{title:"Digg"},diigo:{title:"Diigo"},facebook:{title:"Facebook"},fark:{title:"Fark"},faves:{title:"Faves"},fresqui:{title:"Fresqui"},friendfeed:{title:"FriendFeed"},funp:{title:"Funp"},google_bmarks:{title:"G Bookmarks"},hi5:{title:"Hi5",onClick:function(a){widget.showPage("post|hi5");a.stop()},type:"post"},kirtsy:{title:"Kirtsy"},linkedin:{title:"LinkedIn"},livejournal:{title:"LiveJournal",onClick:function(a){widget.showPage("post|livejournal");a.stop()},type:"post"},meneame:{title:"Meneame"},mister_wong:{title:"Mr Wong"},mixx:{title:"Mixx"},myspace:{title:"MySpace"},n4g:{title:"N4G"},newsvine:{title:"Newsvine"},oknotizie:{title:"Oknotizie"},propeller:{title:"Propeller"},reddit:{title:"Reddit"},slashdot:{title:"Slashdot"},simpy:{title:"Simpy"},sphinn:{title:"Sphinn"},stumbleupon:{title:"Stumbleupon"},technorati:{title:"Technorati",dontUseEncodedURL:"Encoded URLs are not allowed"},twackle:{title:"Twackle"},twine:{title:"Twine"},twitter:{title:"Twitter",onClick:function(a){page=widget.pages.home;createSharURL(glo_url,true);widget.fireEvent("twitterClicked",glo_url);widget.showPage("post|twitter");a.stop()},useSharURL:"Shar URLs are allowed"},typepad:{title:"TypePad",onClick:function(a){widget.showPage("post|typepad");a.stop()},type:"post"},windows_live:{title:"Live"},wordpress:{title:"WordPress",onClick:function(a){widget.showPage("post|wordpress");a.stop()},type:"post"},xanga:{title:"Xanga"},yahoo_bmarks:{title:"Y! Bookmarks"},ybuzz:{title:"Buzz Up!"},yigg:{title:"Yigg"}},contactSources:{aim:{title:"AIM Share",protocolName:"aim"},aol:{title:"AOL",protocolName:"aol"},gmail:{title:"GMail",protocolName:"gmail"},hotmail:{title:"Hotmail",protocolName:"hotmail"},msn:{title:"MSN",protocolName:"hotmail"},twitter:{title:"Twitter",protocolName:"twitter"},yahoo:{title:"Yahoo!",protocolName:"yahoo"},facebook:{title:"Facebook",protocolName:"facebook"}},loginSources:{yahoo:{title:"Yahoo!",protocolName:"yahoo"},sharethis:{title:"ShareThis",protocolName:"sharethis"}}});Widget.implement({getServiceType:function(a){if("type" in this.services[a]){return this.services[a].type}return"web"},getServiceLink:function(e){var b=this.services[e];if(!b){return true}var f="javascript:void(0)";var h="";if(b.aTitle){h=b.aTitle}var g="button";if(glo_toolbar!=false){g="toolbar"}else{if(glo_page!="home"&&glo_page!=""){g="chicklet"}else{g="button"}}if(b.title=="Twitter"&&glo_userType=="twitter"){b.type="post"}if(!b.type){b.submitUrl="http://wd.sharethis.com/api/sharer.php?destination={destination}&url={url}&title={title}&publisher={publisher}&fpc={fpc}&sessionID={sessionID}&source="+g}if("submitUrl" in b&&b.submitUrl.length){var j=b.useSharURL?getSharURL():addHashTracking(glo_url);if(b.dontUseEncodedURL){f=b.submitUrl.replace("{title}",glo_title).replace("{url}",j).replace("{content}",glo_content).replace("{destination}",e).replace("{publisher}",glo_publisher).replace("{fpc}",glo_fpc).replace("{sessionID}",glo_sessionID)}else{f=b.submitUrl.replace("{title}",encodeURIComponent(glo_title)).replace("{url}",encodeURIComponent(j)).replace("{content}",glo_content).replace("{destination}",e).replace("{publisher}",glo_publisher).replace("{fpc}",glo_fpc).replace("{sessionID}",glo_sessionID)}}var d=new Element("a",{"class":e,rel:"external",style:"color:"+glo_linkfg+";",target:(glo_options_popup?"_top":("linkTarget" in b?b.linkTarget:"_blank")),href:f,title:h,id:"post_"+e+"_link"});d.addEvent("click",(function(a){gaLog("Home","chicklet_click",e);logSW(e);if(widget.user){widget.user.logServiceUse(e)}if("onClick" in b&&b.title!=="Twitter"){b.onClick.bind(b)(a,f)}else{if("onClick" in b&&b.title=="Twitter"&&glo_userType=="twitter"){b.onClick.bind(b)(a,f)}else{widget.showPage("done")}}if(f!="javascript:void(0)"){if(glo_options_popup==true){popupOpen2(this);a.stop()}}}).bind(d));d.appendText(b.title);return d},getDummyServiceLink:function(){var b=new Element("a",{href:"javascript:void(0);"});return b.appendText(" ")}});Widget.Contact=new Class({Implements:Events,service:"",name:"",address:"",id:"",selected:false,added:false,widget:null,inventName:false,_isAContact:true,toString:function(){var a="";if(widget.user.contactSortMode=="name"){a=this["service"]}else{if(widget.user.contactSortMode=="service"){a=this["name"]}}return(this[widget.user.contactSortMode]+" - "+a).toLowerCase()},initialize:function(b,a){this.widget=b;for(var d in a){if(a[d]){this[d]=a[d]}}},select:function(){this.selected=true;this.fireEvent("selected",true)},deselect:function(){this.selected=false;this.fireEvent("selected",false)},toggleSelect:function(){if(this.selected==false){this.select()}else{if(this.selected==true){this.deselect()}}},setName:function(a){this.name=a;this.fireEvent("nameChanged",this.name)},setAddress:function(a){this.address=a;this.fireEvent("addressChanged",this.address)},setService:function(a){this.service=a;this.fireEvent("serviceChanged",this.service)},isEqualTo:function(a){if(a.address&&a.service){return a.address.toLowerCase()==this.address.toLowerCase()&&a.service==this.service}return false}});Widget.Contact.guessServiceForAddress=function(a,b){if(b){switch(b){case"gmail":return"email";break;case"aim":return"aim";break;case"myspace":return"myspace";break;case"aol":return"email";break;case"msn":return"email";break;case"yahoo":return"email";break;case"hotmail":return"email";break;break}}if(!a.test(/[^\d\-\(\)]/)){return"sms"}else{if(a.indexOf("@")>=0){return"email"}}return null};Widget.Contact.generateNameFromAddress=function(a){if(a.indexOf("@")!=-1){return a.substr(0,a.indexOf("@"))}else{if(a.test(/[^\d\-\(\)]/)){return a}}return""};Widget.Carousel=new Class({Implements:Events,initialize:function(d,b){if($type(d)=="element"){this.domContainer=$(d)}else{if($type(d)=="string"){this.domContainer=$(d)}}var a=this;$("fwd_arrow").addEvent("click",function(e){gaLog("Home","carousel_fwd_arrow","Carousel Forward Arrow");if(a.getNumPages()>1){a.advance()}e.stop()});$("back_arrow").addEvent("click",function(e){gaLog("Home","carousel_back_arrow","Carousel Backward Arrow");if(a.getNumPages()>1){a.rewind()}e.stop()})},autoSize:function(){if(this.totalDummies>6){this.nRows=2;this.createPaginator();this.domContainer.getElement(".view").setStyle("height","44px")}},setDataSource:function(a){this.data=a;this.page=0;this.paginatorExists=false;this.data.sort(function(e,d){if(e.hasUserPref&&d.hasUserPref){return e.userIndex-d.userIndex}if(e.hasUserPref){return -1}if(d.hasUserPref){return 1}if(e.hasPublisherPref&&d.hasPublisherPref){return e.publisherIndex-d.publisherIndex}if(e.hasPublisherPref){return -1}if(d.hasPublisherPref){return 1}return e.stIndex-d.stIndex});this.render()},setNumRows:function(a){this.nRows=a;this.render()},setNumColumns:function(a){this.nCols=a;this.render()},_buildPage:function(f){if(this.paginatorExists==false){this.createPaginator()}this.autoSize();this.highlightNum(f+1);f=this.getEffectivePageNum(f);var e=this.getVisibleData();var g=new Element("div",{"class":"group"});var d=(this.nRows*this.nCols);for(var b=(f*d);b<(f*d)+d;b++){if(b<e.length){var a=e[b].getContent();g.grab(a)}}return g},getNumPages:function(){var a=this.getVisibleData();return Math.ceil(a.length/(this.nRows*this.nCols))},getVisibleData:function(){if(this.isShowingMore){return this.data}else{var f=[];var b=(this.nRows*this.nCols);var l=(this.data.length&&(this.data[0].hasPublisherPref));var m=false;this.totalDummies=0;for(var g=0;g<this.data.length;g++){var a=(g>1)&&(this.data[g-1].hasPublisherPref);var h=this.data[g].hasPublisherPref||this.data[g].hasUserPref;if(!this.isShowingMore&&!m&&(g<b)&&l&&!h){var e=g;while(e<b){f.push({isDummy:function(){return true},getContent:function(){return widget.getDummyServiceLink()}});e++;this.totalDummies++}m=true}f.push(this.data[g])}if(glo_exclusive_services&&this.data.length<b){var d=this.data.length;while(d<b){f.push({isDummy:function(){return true},getContent:function(){return widget.getDummyServiceLink()}});d++;this.totalDummies++}m=true}return f}},getEffectivePageNum:function(b){var a=this.getVisibleData();var d=this.getNumPages();if(b<0){b=d+b}if(b>=d){b=b%d}return b},render:function(){if(this.paginatorExists==false){this.createPaginator()}this.fireEvent("renderBegin");var a=this.domContainer.getElement("div.view").getElement("div.groups");$each(a.getChildren(),function(b){b.dispose()});a.grab(this._buildPage(this.page));this.fireEvent("renderComplete")},createPaginator:function(){var a=this.getNumPages();if(a>1){$("paginator").removeClass("hidden")}else{if(!$("paginator").hasClass("hidden")){$("paginator").addClass("hidden")}}var d=a*20+36;d+="px";$("paginator").setStyle("width",d);var f="";for(var e=0;e<a;e++){var b=e+1;f+="<div class=\"circles\" onclick=\"gaLog('Home', 'carousel_paging_dot', 'Carousel Paging Dot'); widget.carousel.goToPage("+b+');" title='+langTextArray.msg_goto+" # "+b+'"></div> '}$("circle_container").set("html",f);this.highlightNum(this.page+1);this.paginatorExists=true},highlightNum:function(d){var g=this.getNumPages();if(d>g){d=1}if(d<1){d=4}var e=d-1;if($("paginator")){var b=$("circle_container").getChildren();b.removeClass("circles-selected");b.addClass("circles");b[e].addClass("circles-selected");b[e].removeClass("circles");var f="("+d+"/"+this.getNumPages()+")"}},goToPage:function(a){this.page=a-1;this.render();this.highlightNum(a)},advance:function(){if(this.rotating){return}this.rotating=true;this.fireEvent("advanceBegin");var b=this.domContainer.getElement("div.view").getElement("div.groups");var f=b.getElement("div.group");var e=this._buildPage(this.page+1);b.grab(e);var d=f.getSize().x;var a=this;b.get("tween").removeEvents("complete").addEvent("complete",function(){f.dispose();b.setStyle("left",0);a.page=a.getEffectivePageNum(a.page+1);a.fireEvent("advanceComplete");a.rotating=false});b.tween("left",-d)},rewind:function(){if(this.rotating){return}this.rotating=true;this.fireEvent("rewindBegin");var b=this.domContainer.getElement("div.view").getElement("div.groups");var e=b.getElement("div.group");var f=this._buildPage(this.page-1);var d=e.getSize().x;b.setStyle("left",-d);b.grab(f,"top");var a=this;b.get("tween").removeEvents("complete").addEvent("complete",function(){e.dispose();a.page=a.getEffectivePageNum(a.page-1);a.fireEvent("rewindComplete");a.rotating=false});b.tween("left",0)},domContainer:null,nRows:4,nCols:3,page:0,isShowingMore:false,data:[],rotating:false});Widget.Carousel.initialState_more=0;Widget.Carousel.initialState_less=1;Widget.User=new Class({Implements:Events,email:"",name:"",authToken:"",userID:"",thirdparty_token:"",shareHistory:{services:{},recipients:[]},contacts:[],contactsAD:[],contactsEH:[],contactsIL:[],contactsMP:[],contactsQT:[],contactsUZ:[],_selectedContacts:[],contactSortMode:"name",contactServiceFilters:[],widget:null,credentials:[],_deferringContactSelectionChangedTimer:-1,initialize:function(b){this.widget=b;var d=b.getCookie("ServiceHistory");if(d){d=JSON.decode(d);for(var a in d){this.setShareServiceHistory(d[a])}}},setShareServiceHistory:function(a){this.shareHistory.services[a.service]=a},getShareServiceHistory:function(){var b=[];for(var a in this.shareHistory.services){b.push($extend({},this.shareHistory.services[a]))}b.sort(function(e,d){return d.count-e.count});return b},clearShareServiceHistory:function(){this.shareHistory.services={}},addRecentRecipient:function(a){this.shareHistory.recipients.push(a);this.fireEvent("recipientHistoryChanged",{recipients:this.shareHistory.recipients})},getRecentRecipients:function(){return this.shareHistory.recipients},clearRecentRecipients:function(){this.shareHistory.recipients=[]},isSignedIn:function(){return this.authToken&&this.authToken.length},acquireAuth:function(a){if(widget.getCookie("ShareUT")!==a){forgetUser()}if(this.authToken.length){this.signOut()}this.authToken=a;widget.setCookie("ShareUT",this.authToken);widget.setCookie("ServiceHistory",JSON.encode({}));setGlobals("auth",a);setGlobals("loggedIn",true);this.fireEvent("signedIn");this.getUserAccountInfo();this.getContactsOnAccount()},signIn:function(d,a){var b=new Request({method:"post",url:"/api/getAuth_ws.php",data:"username="+d+"&password="+a+"&return=json",onFailure:function(){logError("signin","Ajax Failure")},onSuccess:(function(g){try{var e=JSON.decode(g)}catch(f){logError("signin",g)}if(e.status==="SUCCESS"){this.acquireAuth(e.data.token)}else{if(e.statusMessage==="INVALID_USERNAME_OR_PASSWORD"){this.fireEvent("signInFailed",langTextArray.msg_incorrect_pass)}else{if(e.statusMessage==="DATABASE_FAILED"){this.fireEvent("signInFailed",langTextArray.msg_server_connect_auth);logError("signin","unable to connect to db")}else{this.fireEvent("signInFailed",langTextArray.msg_incorrect_pass)}}}}).bind(this)});b.send();this.fireEvent("signInRequested")},signOut:function(){glo_credentials=[];this.contacts=[];this._selectedContacts=[];this.clearShareServiceHistory();this.clearRecentRecipients();this.contactSortMode="name";this.email="";this.name="";this.userID="";this.thirdparty_token="";this.fireEvent("contactsChanged");this.fireEvent("contactSelectionChanged");this.authToken="";glo_thirdparty_flag="";this.fireEvent("signedOut");glo_isLoggedIn=false},getUserAccountInfo:function(){if(this.isSignedIn()){var a=new Request({method:"post",url:"/api/getUserInfo_ws.php",data:"token="+this.authToken+"&return=json",onFailure:function(){logError("get user info","Ajax Failure")},onSuccess:(function(f){try{var d=JSON.decode(f)}catch(e){logError("get user info",f)}if(d.status==="SUCCESS"){var g=false;$("textAuthInfoEmail").removeClass("hidden");setGlobals("userName",d.data.name);setGlobals("userEmail",d.data.email);g=d.data.email;if(d.data.CurrentUserType&&d.data.CurrentUserType=="facebook"&&d.data.ThirdPartyUsers){setGlobals("userType",d.data.CurrentUserType);g=d.data.name}else{if(d.data.CurrentUserType&&d.data.ThirdPartyUsers){setGlobals("userType",d.data.CurrentUserType);var b="<span style='margin-right:0px'class='"+d.data.CurrentUserType+"'>"+d.data.ThirdPartyUsers[d.data.CurrentUserType]+"</span>";g=b;if(d.data.email==""||d.data.email==undefined||d.data.email=="undefined"){setGlobals("userEmail",d.data.ThirdPartyUsers[d.data.CurrentUserType])}}}if(g==""||g==undefined||g=="undefined"){g=d.data.name;$("textAuthInfoEmail").set("html",g)}else{$("textAuthInfoEmail").set("html",g)}this.name=d.data.name;this.email=d.data.email;this.userID=d.data.userID;this.credentials=d.data.credentials;this.thirdparty_token=d.data.thirdparty_token;glo_thirdparty_flag=d.data.UserType;glo_credentials=this.credentials;if(d.data.socialShares){d.data.socialShares.each((function(h){if(h.name&&h.count){this.setShareServiceHistory({service:h.name.toLowerCase(),count:parseInt(h.count)})}}).bind(this))}if(d.data.recipients){d.data.recipients.each((function(h){this.addRecentRecipient(h)}).bind(this))}this.fireEvent("infoChanged",this)}else{logError("get user info",JSON.encode(d));setTimeout((function(){this.signOut()}).bind(this),1)}}).bind(this)});this.clearRecentRecipients();this.clearShareServiceHistory();a.send()}},getContactsOnAccount:function(){var a=new Request({method:"post",url:"/api/getContacts_ws.php",data:"token="+this.authToken+"&return=json",onFailure:function(){logError("get contacts","Ajax Failure")},onSuccess:(function(f,g){try{var d=JSON.decode(f)}catch(e){logError("get contacts",f)}if(d.status==="SUCCESS"&&d.data){var b=d.data;this.contacts=[];this._selectedContacts=[];this.addContactsLocally(b);this.fireEvent("getContactsSucceeded",b)}else{logError("get contacts",JSON.encode(d));this.fireEvent("getContactsFailed")}}).bind(this)});a.send();this.fireEvent("getContactsRequested")},addContactsToAccount:function(b){var d=encodeURIComponent(JSON.encode(b));var a=new Request({method:"post",url:"/api/addContacts_ws.php",data:"token="+this.authToken+"&contacts="+d+"&return=json",onFailure:function(){logError("add contacts","Ajax Failure")},onSuccess:(function(j){try{var e=JSON.decode(j)}catch(g){logError("add contacts",j)}if(e.status=="SUCCESS"){var h=null;h=(function(){this.fireEvent("addContactsToAccountSucceeded");this.removeEvent("getContactsSucceeded",h)}).bind(this);this.addEvent("getContactsSucceeded",h);this.getContactsOnAccount()}else{logError("add contacts",JSON.encode(e));this.fireEvent("addContactsToAccountFailed")}}).bind(this)});this.fireEvent("addContactToAccountRequested");a.send()},addContactsLocally:function(k){var l=[];for(var b=0;b<k.length;b++){var d=this.isSignedIn();var h=false;if(!d){for(var a=0;a<this.contacts.length;a++){if(this.contacts[a].isEqualTo(k[b])){h=true;break}}}if(!h||d){var f=null;if(k[b]._isAContact){f=k[b];var g=(new Date()).getTime();g+=Math.random();if(f.id==""){f.id=g}}else{var e=k[b];var g=(new Date()).getTime();g+=Math.random();f=new Widget.Contact(this,{service:e.service?e.service.toLowerCase():"email",name:e.name?e.name:"",address:e.address?e.address:"",id:e.id?e.id:g})}f.addEvent("selected",(function(j){return(function(m){if(m){this._selectedContacts.include(j);if((!glo_widget_info.session_token||this._selectedContacts.length>5)&&!glo_widget_info.require_captcha){glo_widget_info.require_captcha=1;if(typeof(Recaptcha)=="undefined"){odjs("http://api.recaptcha.net/js/recaptcha_ajax.js",function(){Recaptcha.create("6Leh9AIAAAAAAHYpIPrfzeRFMrHC2QysVPB93Qhh","captcha")})}else{Recaptcha.create("6Leh9AIAAAAAAHYpIPrfzeRFMrHC2QysVPB93Qhh","captcha")}if(!glo_widget_info.session_token){gaLog("Send","captcha_shown","no session token")}if(this._selectedContacts.length>5){gaLog("Send","captcha_shown","too many recipients")}}}else{this._selectedContacts.erase(j)}widget.deferWhile("contactSelectionIsChanging",(function(){this.fireEvent("contactSelectionChanged")}).bind(this))}).bind(this)}).bind(this)(f));this.contacts.push(f);l.push(f);setGlobals("contProto",k[b].service?k[b].service.toUpperCase():"email");setGlobals("contName",k[b].name);setGlobals("contAdd",k[b].address)}}this.fireEvent("contactsChanged");return l},setContactSortMode:function(a){this.contactSortMode=a},searchContacts:function(b){var e=[];if(!b.length){return e}var a=[searchName,searchName2,searchName3,searchAdd,searchName4,searchName5];if(typeof b=="number"){e.combine(searchAdd(b))}for(var d=0;d<a.length&&e.length<widget.maxContactSearchResults;d++){e.combine(a[d](b))}if(this.contactServiceFilters.length){e=e.filter((function(f){return this.contactServiceFilters.indexOf(this.contacts[f].service)>=0}).bind(this))}return e.map((function(f){return this.contacts[f]}).bind(this))},searchContactsExact:function(b,d){var a=this.contacts.length;for(var e=0;e<a;e++){if(this.contacts[e].service==b&&this.contacts[e].address==d){return this.contacts[e]}}return null},getSelectedContacts:function(){return this._selectedContacts},deselectContacts:function(){for(var a=0;a<this._selectedContacts.length;a++){this._selectedContacts[a].deselect()}},hasContactsOnService:function(b){for(var a=0;a<this.contacts.length;a++){if(this.contacts[a].service==b){return true}}return false},logServiceUse:function(a,b){b=(typeof b=="undefined")?1:b;if(this.shareHistory.services[a]){this.shareHistory.services[a].count+=b}else{this.shareHistory.services[a]={service:a,count:b}}widget.setCookie("ServiceHistory",JSON.encode(this.shareHistory.services))}});Widget.MirrorContact=new Class({Extends:Widget.Contact,added:false,respondToLiveUpdate:true,isMirror:true,select:function(){if(!this.added){this.respondToLiveUpdate=false;this.widget.user.addContactsLocally([this]);this.added=true}this.parent()},toString:function(){var a="";if(widget.user.contactSortMode=="name"){a=this["service"]}else{if(widget.user.contactSortMode=="service"){a=this["name"]}}return(this[widget.user.contactSortMode]+" - "+a).toLowerCase()}});Widget.ToField=new Class({Implements:Events,contacts:[],domContainer:null,inputElement:null,inputElementContainer:null,widget:null,highlightedResult:null,resultsElement:null,mirrorInputResultItem:null,mirrorContact:null,searchResults:[],searchText:"",selectedTokens:[],_windowKeyDownHandler:null,_mouseOverSearchResultsList:false,_searchResultsShown:false,initialize:function(b,a){this.widget=b;this.domContainer=a;b.user.addEvent("contactSelectionChanged",this._handleWidgetSelectionChanged.bind(this));b.user.addEvent("contactsChanged",this._handleWidgetContactsChanged.bind(this));a.addEvent("mousedown",this._handleMouseDown.bind(this));a.addEvent("mouseup",this._handleMouseUp.bind(this));this.addEvent("contactsChanged",this._render.bind(this),true);this.addEvent("searchTextChanged",this._handleSearchTextChanged.bind(this),true);this._getInputField();this._getMirrorContact();this._render()},getRecipients:function(){return $A(this.contacts)},showSearchResults:function(){var a=this._getSearchResultsList();a.tween("opacity",0.9);this._searchResultsShown=true},hideSearchResults:function(){var a=this._getSearchResultsList();this.highlightedResult=null;a.tween("opacity",0);this._searchResultsShown=false},setSearchText:function(a){this.searchText=a;this.fireEvent("searchTextChanged",this.searchText)},_handleSearchTextChanged:function(a){if(a.length){this._search(a)}else{this.hideSearchResults()}},_search:function(h){this.searchResults=widget.user.searchContacts(h);var f=this._getSearchResultsList();f.getChildren().each((function(j){this._disposeSearchResult(j)}).bind(this));this.searchResults=this.searchResults.filter(function(j){return !j.selected});if(this.searchResults.length==0){this.searchResults.unshift(this._getMirrorContact())}f.setStyle("height","auto");var b=$("send_to_field");var d=widget.getCurrentPage().domContainer;var a=b.getCoordinates(d).bottom+b.getScroll().y;var g=d.getSize().y-a-15;for(var e=0;e<this.searchResults.length;e++){f.grab(this._createSearchResult(this.searchResults[e]));if(f.getSize().y>g){f.setStyle("height",g+"px")}else{f.setStyle("height","auto")}}this.showSearchResults();this._highlightResult(0)},_getMirrorContact:function(){if(this.mirrorContact){return this.mirrorContact}var d=new Widget.MirrorContact(this.widget,{service:"email",name:"",address:"",id:""});this.mirrorContact=d;var b=function(e){if(d.respondToLiveUpdate){d.setAddress(e);d.setName(e);d.setService(Widget.Contact.guessServiceForAddress(e)||"email")}};var a=this;d.addEvent("selected",function(e){var g=arguments.callee;setTimeout(function(){d.removeEvent("selected",g)},1);a.removeEvent("searchTextChanged",b);a.mirrorContact=null});this.addEvent("searchTextChanged",b);return this.mirrorContact},_highlightResult:function(d,f,j){var e=this._getSearchResultsList();if(typeof d=="number"){f=this.searchResults[d]||this._getMirrorContact();d=e.getElements("li")[d]}if(this.highlightedResult){this.highlightedResult.removeClass("highlight")}this.highlightedResult=d;if(this.highlightedResult){this.highlightedResult.addClass("highlight");if(j==undefined||j==Widget.ToField.scrollBehavior_scroll){var b=this.highlightedResult.getPosition(e).y;var h=this.highlightedResult.getSize().y;var g=e.getScroll().y;var a=e.getSize().y;b+=(Browser.Engine.trident?g:0);if(b<g){e.scrollTo(0,b)}if(b+h>g+a){e.scrollTo(0,g+((b+h)-(g+a)))}}}},_getHighlightedResultIndex:function(){if(this.highlightedResult&&this.highlightedResult._stContact){for(var a=0;a<this.searchResults.length;a++){if(this.searchResults[a]==this.highlightedResult._stContact){return a}}}return -1},_highlightPrevResult:function(){var a=this._getHighlightedResultIndex();if(a>0){this._highlightResult(a-1)}},_highlightNextResult:function(){var a=this._getHighlightedResultIndex();if(a>=0&&a<this.searchResults.length-1){this._highlightResult(a+1)}},_disposeSearchResult:function(b){for(var a in b._stEventHandlers.self){b.removeEvent(a,b._stEventHandlers.self[a])}for(var a in b._stEventHandlers.contact){b._stContact.removeEvent(a,b._stEventHandlers.contact[a])}b.destroy()},_createSearchResult:function(b){var f=new Element("li",{"class":"search_result",id:"search_result_"+b.id});var e=new Element("div",{"class":(b.service.length?b.service:"email")});var d=new Element("div",{"class":"address"});d.set("text","<"+b.address+">");var a=(b.name.indexOf("@")==-1?b.name:b.name.substr(0,b.name.indexOf("@")));e.set("text",a);b.addEvent("addressChanged",function(g){d.set("text","<"+g+">")});b.addEvent("nameChanged",function(g){e.set("text",(g.length?g:""))});f._stEventHandlers={self:{mouseenter:(function(g){this._highlightResult(f,b,Widget.ToField.scrollBehavior_dontScroll)}).bind(this),mouseleave:(function(g){setTimeout((function(){if(this.highlightedResult==f){f.removeClass("highlight");this.highlightedResult=null}}).bind(this),100)}).bind(this),click:(function(g){b.select();this.hideSearchResults()}).bind(this)},contact:{serviceChanged:function(g){e.set("class",g)}}};f._stContact=b;f.grab(e).grab(d).addEvent("mouseenter",f._stEventHandlers.self.mouseenter).addEvent("mouseleave",f._stEventHandlers.self.mouseleave).addEvent("click",f._stEventHandlers.self.click);b.addEvent("serviceChanged",f._stEventHandlers.contact.serviceChanged);if(b.isMirror){f.addClass("mirror")}return f},_selectHighlightedResult:function(){if(this.highlightedResult&&this.highlightedResult._stContact){if(this.highlightedResult._stContact.address.length){this.highlightedResult._stContact.select();this.hideSearchResults()}}setTimeout((function(){this._insertInputField()}).bind(this),10)},_getSearchResultsList:function(){if(this.resultsElement){return this.resultsElement}this.resultsElement=new Element("ul",{id:"search_results","class":"search_results"});this.domContainer.getParent().grab(this.resultsElement,"bottom");this.resultsElement.set("tween",{duration:250});this.resultsElement.addEvent("mouseenter",(function(a){this._mouseOverSearchResultsList=true}).bind(this));return this.resultsElement},_getInputField:function(){if(this.inputElementContainer){return this.inputElementContainer}this.inputElementContainer=new Element("div",{id:"contact_search_field_container"});this.inputElement=new Element("input",{type:"text",id:"contact_search_field","class":"contact_search_field"});this.inputElement.addEvent("keydown",(function(a){switch(a.key){case"up":widget.pages.send.toField._highlightPrevResult();a.stop();break;case"down":widget.pages.send.toField._highlightNextResult();a.stop();break;case"enter":widget.pages.send.toField._selectHighlightedResult();a.stop();break;case"esc":this.hideSearchResults();a.stop();break}switch(a.code){case 188:widget.pages.send.toField._selectHighlightedResult();a.stop();break}}).bind(this));this.inputElement.addEvent("keyup",(function(a){var b=this.inputElement.get("value");if(this.searchText!=b){this.setSearchText(b)}}).bind(this));this.addEvent("searchTextChanged",(function(a){this.set("value",a)}).bind(this.inputElement));this.inputElement.addEvent("blur",(function(){if($("contact_search_field").value.length){widget.pages.send.toField._selectHighlightedResult();widget.pages.send.toField.hideSearchResults()}}),this);this.inputElement.addEvent("focus",(function(){if(widget.pages.send.toField.searchText.length){widget.pages.send.toField.showSearchResults()}}),this);this.inputElementContainer.grab(this.inputElement);return this.inputElement},_mouseInResultsListScrollBar:function(a){var b=this._getSearchResultsList().getCoordinates();return false;return(a.page.x>=b.left&&a.page.x<=b.right&&a.page.y>=b.top&&a.page.y<=b.bottom)},_deleteSelectedTokens:function(){for(var a=0;a<this.selectedTokens.length;a++){this.selectedTokens[a].contact.deselect()}this.selectedTokens.empty()},_handleMouseDown:function(a){if(a.target==this.domContainer){this._insertInputField();a.stop()}},_insertInputField:function(){var b=this._getInputField();this.domContainer.appendChild(b);this.domContainer.scrollTo(0,this.domContainer.getScrollSize().y);var a=widget.pages.send.toField.inputElement.id;setTimeout((function(){try{var f=$("contact_search_field_container").firstChild.id;var e=document.getElementById(f);if(f=="contact_search_field"&&e&&glo_browser.test("ie")==false){e.select()}}catch(d){}}),500)},_handleMouseUp:function(a){},_handleWidgetContactsChanged:function(){this._handleWidgetSelectionChanged();this._render()},_handleWidgetSelectionChanged:function(){var b=widget.user.getSelectedContacts();this.contacts=[];for(var a=0;a<b.length;a++){this.contacts.push(b[a])}this.fireEvent("contactsChanged");this.setSearchText("");widget.pages.send.updateCharacterCounter()},_clearList:function(){this.domContainer.getChildren().each(function(a){if(a.hasClass("token")){a.destroy()}else{a.dispose()}})},_createToken:function(a,d){var b='<a class="token" href="javascript:void(0);" >';b+='<span title= "'+a.name+"<"+a.address+'>" class="'+(a.service.length?a.service:"email")+'">';b+='<img class="token_x" id="token_img" src="">'+widget.truncateText(a.name,130);b+="</span></span></a>";return b},_attachTokenBehavior:function(d,a){$extend(d,{contact:a,pageCoordinateIsOverX:function(e){var g=this.getSize().x-20;var f=this.getPosition().x;return(e-f>g)}});d.addEvent("click",(function(e){if(d.pageCoordinateIsOverX(e.page.x)&&d.contact){d.contact.deselect()}}).bind(this));var b=(function(e){if(d.pageCoordinateIsOverX(e.page.x)){}else{}}).bind(this);d.addEvent("mousemove",b);d.onselectstart=function(){return false};d.unselectable="on";d.style.MozUserSelect="none"},_getContentsHeight:function(){var b=0;var a=0;this.domContainer.getChildren().each(function(d){if(d.getPosition().y!=a){b+=d.getSize().y}a=d.getPosition().y});return b},_render:function(){this._clearList();var b="";for(var a=0;a<this.contacts.length;a++){b+=this._createToken(this.contacts[a],Widget.ToField.createToken_asHTML)}this.domContainer.set("html",b);this.domContainer.getElements(".token").each((function(f,e){this._attachTokenBehavior(f,this.contacts[e])}).bind(this));var d=this._getContentsHeight();if(d*2<14){this.domContainer.setStyles({height:"14px",overflow:"hidden"})}else{if(d*2>70){this.domContainer.setStyles({height:"70px",overflow:"auto"})}else{this.domContainer.setStyles({height:d*2+"px",overflow:"hidden"})}}},onPageShown:function(){setTimeout((function(){this._insertInputField()}).bind(this),100);this._render()},onPageHidden:function(){document.removeEvent("keydown",this._windowKeyDownHandler)}});Widget.ToField.createToken_asNode=0;Widget.ToField.createToken_asHTML=1;Widget.ToField.scrollBehavior_dontScroll=0;Widget.ToField.scrollBehavior_scroll=1;window.addEvent("domready",function(){domReady=true;if(segmentRun==false){var j=/fpc=.*?\//gi;var n="";n=glo_initFrag.match(j);if(n!==null){n=n[0];n=n.replace("/","");var e=document.getElementById("segmentDiv");var l="http://wd.sharethis.com/api/getSegment.php?"+n;segmentframe.src=l;e.appendChild(segmentframe);segmentRun=true}}var d=(("https:"==document.location.protocol)?"https://ssl.":"http://www.");var g=document.getElementsByTagName("head")[0];var p=document.createElement("script");p.type="text/javascript";p.src=d+"google-analytics.com/ga.js";g.appendChild(p);var f='try{var pageTracker = _gat._getTracker("UA-1645146-9");pageTracker._trackPageview();} catch(err) {}';var p=document.createElement("script");p.type="text/javascript";p.text=f;g.appendChild(p);if(glo_options_popup===true&&glo_toolbar==false){$("close_button").set("style","display:none")}widget=new Widget();widget.readyPages(widget.pages);if(glo_initRun===true){processBuffer()}else{createSwList()}var o=[];o=$$("input");for(i=0;i<o.length;i++){o[i].setAttribute("autocomplete","off")}emptyInputs();$("linkSignIn").addEvent("click",function(){gaLog("Footer","signin_link","Sign In Link");window.open("http://sharethis.com/account/signin-widget","LoginWindow","status=1, height=700, width=970, resizable=0");glo_login_poller=setInterval(checkForLoginCookie,1000)});$("sharethis_login").addEvent("click",function(){gaLog("Footer","signin_link","ShareThis");window.open("http://sharethis.com/account/signin-widget","LoginWindow","status=1, height=700, width=970, resizable=0");glo_login_poller=setInterval(checkForLoginCookie,1000)});$("yahoo_login").addEvent("click",function(){gaLog("Footer","signin_link","Yahoo");window.open("http://sharethis.com/account/signin-widget","LoginWindow","status=1, height=700, width=970, resizable=0");glo_login_poller=setInterval(checkForLoginCookie,1000)});$("import_contacts_link_yahoo").addEvent("click",function(){forgetUser();window.open("http://sharethis.com/account/import-widget?provider=yahoo","ImportWindow","status=1, height=700, width=970, resizable=0");glo_import_poller=setInterval(checkForImportCookie,1000)});$("import_contacts_link_google").addEvent("click",function(){forgetUser();window.open("http://sharethis.com/account/import-widget?provider=google","ImportWindow","status=1, height=700, width=970, resizable=0");glo_import_poller=setInterval(checkForImportCookie,1000)});$("google_login").addEvent("click",function(){gaLog("Footer","signin_link","Google");window.open("http://sharethis.com/account/signin-widget","LoginWindow","status=1, height=700, width=970, resizable=0");glo_login_poller=setInterval(checkForLoginCookie,1000)});$("twitter_login").addEvent("click",function(){gaLog("Footer","signin_link","Twitter");window.open("http://sharethis.com/account/signin-widget","LoginWindow","status=1, height=700, width=970, resizable=0");glo_login_poller=setInterval(checkForLoginCookie,1000)});$("linkSignOut").addEvent("click",function(){gaLog("Footer","signout_link","Sign Out Link");if(glo_page=="send"||glo_page=="post|twitter"){widget.showPage(glo_page)}else{widget.showPage("home")}widget.signOut()});widget.user.addEvent("signedOut",function(){$("colophon").removeClass("signed_in")});widget.user.addEvent("signedIn",function(){widget.popModalWorkingSheet();$("colophon").addClass("signed_in");widget.showPage("home");widget.fireEvent("signInComplete")});widget.addEvent("headerTitleChanged",function(a){$("header_title").set("text",a);if(!a.length){$("header_title").addClass("hidden")}else{if(glo_ads==false){$("header_title").removeClass("hidden")}}});widget.addEvent("headerFGColorChanged",function(a){$("header_title").setStyle("color",a)});if(glo_headerTitle){widget.fireEvent("headerTitleChanged",glo_headerTitle);widget.fireEvent("headerFGColorChanged",glo_headerfg)}widget.addEvent("linkForegroundColorChanged",function(a){for(var b in widget.pages){$(widget.pages[b].id).getElements("a").each(function(r){r.setStyle("color",a)})}});var h=widget.getCookie("ShareUT");if(h){widget.user.acquireAuth(h)}Cookie.dispose("import",{domain:".sharethis.com",path:"/"});Cookie.dispose("import_delt",{domain:".sharethis.com",path:"/"});$$("input").each(function(a){a.addEvent("focus",function(){widget.captureLastFocus(a)})});$("post_remember_me").addEvent("click",function(){var b=new Array("post_url","post_username","post_password");if($("post_remember_me").checked==false){for(var r=0;r<=glo_credentials.length;r++){if(glo_credentials[r]&&glo_credentials[r].service==glo_post_page){glo_credentials.splice(r,1)}}gaLog("Post","post_remember_me_click","forget_me");$("post_forget_me").value="true";b.each(function(s){widget.unfreezeTextInput($(s));$(s).value=""});widget.initPost(glo_post_page);widget.pages.post.pages[glo_post_page].onShow()}else{var a=new Object();a.service=glo_post_page;a.url=$("post_url").value;a.username=$("post_username").value;a.password=$("post_password").value;glo_credentials.push(a);gaLog("Post","post_remember_me_click","remember_me");b.each(function(s){widget.freezeTextInput($(s))})}});if(glo_page&&(glo_page=="send"||glo_page.match("post|"))){widget.showPage(glo_page)}else{widget.showPage("home")}if(lang!="en"){$("top_services_title").set("html",langTextArray.most_popular_serv);$("twitter_update_status").set("html",langTextArray.update_status);$("twitter_direct_message").set("html",langTextArray.direct_msg);$("msgstr_to_friend").set("html",langTextArray.to_friend);$("msgstr_recent").set("html",langTextArray.recent);$("msgstr_to_id").set("html",langTextArray.email_to);$("msgstr_from_id").set("html",langTextArray.email_from);$("boxToYourAddrInfo").set("html","("+langTextArray.email_associated+")");$("msgstr_email").set("html",langTextArray.email_message);$("msgstr_character_left").set("html",langTextArray.character_left);$("msgstr_btn_cancel").set("html",langTextArray.btn_cancel);$("msgstr_btn_prev").set("html",langTextArray.btn_preview);$("msgstr_btn_closepre").set("html",langTextArray.btn_close_preview);$("msgstr_btn_send").set("html",langTextArray.btn_send);$("privacyLink_text").set("html",langTextArray.privacy_policy);$("msgstr_imp_share").set("html",langTextArray.email_contacts_access);$("msgstr_email_uname").set("html",langTextArray.username);$("msgstr_email_pass").set("html",langTextArray.password);$("msgstr_imp_cancel").set("html",langTextArray.btn_cancel);$("msgstr_btn_import").set("html",langTextArray["import"]);$("msgstr_reg_share").set("html",langTextArray.register_sharethis);$("msgstr_save_contact").set("html",langTextArray.save_contacts_sharebox);$("msgstr_full_name").set("html",langTextArray.full_name);$("msgstr_sh_email").set("html",langTextArray.email+":");$("msgstr_sh_uname").set("html",langTextArray.username);$("msgstr_sh_pass").set("html",langTextArray.password);$("msgstr_pass_again").set("html",langTextArray.password_again);var q=langTextArray.reg_link.replace(/#%termsSpanStarts%#/,"<span class=\"link\" onclick=\"window.open('http://sharethis.com/terms/','terms','resizable=1,location=1,status=1,scrollbars=1,toolbar=1'); return false;\">");q=q.replace(/#%termsSpanEnd%#/,"</span>");q=q.replace(/#%privacySpanStarts%#/,"<span class=\"link\" onclick=\"window.open('http://sharethis.com/privacy/','privacy','resizable=1,location=1,status=1,scrollbars=1,toolbar=1'); return false;\">");q=q.replace(/#%privacySpanEnds%#/,"</span>");$("registerLegal").set("html",q);$("msgstr_reg_cancel").set("html",langTextArray.btn_cancel);$("msgstr_reg_register").set("html",langTextArray.register);$("registerOK").set("value",langTextArray.btn_ok);$("msgstr_create_acc").set("html",langTextArray.creating_acc);$("registerSuccess").set("html",langTextArray.msg_acc_created);$("msgstr_save_to_sharebox").set("html",langTextArray.save_to_sharebox);$("msgstr_stuff_sharebox").set("html",langTextArray.stuff_sharebox);$("msgstr_tags").set("html",langTextArray.tags);$("msgstr_share_cancel").set("html",langTextArray.btn_cancel);$("msgstr_share_save").set("html",langTextArray.btn_save);$("post_username_label").set("html",langTextArray.username);$("post_url_label").set("html",langTextArray.blog_url);$("post_password_label").set("html",langTextArray.password);$("post_message_label").set("html",langTextArray.email_message);$("msgstr_post_char_cnt").set("html",langTextArray.character_left);$("msgstr_select_blog").set("html",langTextArray.blog_select);$("msgstr_remember_me").set("html",langTextArray.remember_me);$("msgstr_post_btn_cancel").set("html",langTextArray.btn_cancel);$("msgstr_post_btn_save_draft").set("html",langTextArray.btn_save_draft);$("msgstr_post_btn_post").set("html",langTextArray.btn_post);$("msgstr_post_btn_submit").set("html",langTextArray.btn_submit);$("done_message").set("html",langTextArray.msg_shared);$("msgstr_msg_sharing").set("html",langTextArray.msg_sharing);$("msgstr_what_next").set("html",langTextArray.what_next);$("msgstr_addto_toolbar").set("html",langTextArray.add_to_toolbar);var k=langTextArray.sharethis_link.replace(/#%anchorShareStart%#/,"<a class=\"bookmark\" onclick=\"javascript:alert(langTextArray['msg_right_click']); return false;\" href=\"javascript:var%20e=document.createElement('script');e.setAttribute('language','javascript');e.setAttribute('src','http://sharethis.com/share/load');document.body.appendChild(e);void(0);\">");k=k.replace(/#%anchorShareEnd%#/,"</a>");$("doneRegIE").set("html",k);var m=langTextArray.drag_link.replace(/#%anchorStart2%#/,"<a class=\"bookmark\" onclick=\"javascript:alert(langTextArray['msg_drag']); return false;\" href=\"javascript:var%20e=document.createElement('script');e.setAttribute('language','javascript');e.setAttribute('src','http://sharethis.com/share/load');document.body.appendChild(e);void(0);\">");m=m.replace(/#%anchorEnd2%#/,"</a>");$("doneRegOther").set("html",m);$("msgstr_regsiter_now").set("html",langTextArray.register_now);$("msgstr_instantly_share").set("html",langTextArray.instantly_share);$("msgstr_get_button").set("html",langTextArray.get_button);$("msgstr_put_sharethis").set("html",langTextArray.put_sharethis);$("msgstr_share_again").set("html",langTextArray.btn_share_again);$("msgstr_signin_acc").set("html",langTextArray.sign_in);$("msgstr_signin_account").set("html",langTextArray.sign_in_account);$("msgstr_btnlogin_can").set("html",langTextArray.btn_cancel);$("msgstr_login_signin").set("html",langTextArray.sign_in);$("msgstr_create_accnt").set("html",langTextArray.create_account);$("msgstr_succ_signin").set("html",langTextArray.succ_signin);$("msgstr_label_type").set("html",langTextArray.label_type);$("msgstr_btn_skip").set("html",langTextArray.btn_skip);$("msgstr_account_signin").set("html",langTextArray.sign_in);$("footer_ad_header").set("html",langTextArray.advertisement);$("msgstr_link_privacy").set("html",langTextArray.privacy_policy);$("linkSignIn").set("html",langTextArray.sign_in+":");$("myAccLink").set("html",langTextArray.my_account);$("linkSignOut").set("html",langTextArray.sign_out);$("close_widget").set("html",langTextArray.close)}});